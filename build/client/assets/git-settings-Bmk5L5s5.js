import{w as F,R as c}from"./router-CPryua6o.js";import{j as t}from"./ui-Cq19CwDI.js";import{u as q}from"./use-config-BEd2J5_T.js";import{u as Q}from"./use-settings-DphRp9S7.js";import{B as f,u as X}from"./brand-button-CwmiDb9A.js";import{u as z}from"./use-logout-1cyMtnsa.js";import{I as r}from"./declaration-DtqZiF37.js";import{S as p}from"./settings-input-CLGKJpTa.js";import{T as _}from"./Trans-aXGr5pyD.js";import{K as d}from"./key-status-icon-DfYhW2cB.js";import{u as m}from"./useTranslation-8HK8Q2x7.js";import{a as J,d as W}from"./custom-toast-handlers-qEjLUNGq.js";import{r as Y}from"./retrieve-axios-error-message-CoJTAmT2.js";import{I as N}from"./input-skeleton-BqX4Bc0H.js";import{S as y}from"./subtext-skeleton-CtiWmIrt.js";import{u as Z}from"./open-hands-axios-bwh8x0Ai.js";import{S as tt}from"./secrets-service-R2uAE4Km.js";import{u as et}from"./use-user-providers-Ddi7hhkA.js";import"./vendor-Csw2ODfV.js";import"./useQuery-C1weQHjG.js";import"./open-hands-Dol13NBS.js";import"./module-eUUeIAmF.js";import"./mutation-C1zRO6D6.js";import"./utils-SnfsJp9N.js";import"./optional-tag-B9pz552A.js";import"./i18nInstance-DBIXdvxg.js";import"./index-t-SiDJv5.js";function st(){return t.jsx("p",{"data-testid":"github-token-help-anchor",className:"text-xs",children:t.jsx(_,{i18nKey:r.GITHUB$TOKEN_HELP_TEXT,components:[t.jsx("a",{"aria-label":"GitHub token help link",href:"https://github.com/settings/tokens/new?description=openhands-app&scopes=repo,user,workflow",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"github-token-help-anchor-link"),t.jsx("a",{"aria-label":"GitHub token see more link",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"github-token-help-anchor-link-2")]})})}function nt({onChange:n,onGitHubHostChange:a,isGitHubTokenSet:o,name:l,githubHostSet:e}){const{t:i}=m();return t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(p,{testId:l,name:l,onChange:n,label:i(r.GITHUB$TOKEN_LABEL),type:"password",className:"w-full max-w-[680px]",placeholder:o?"<hidden>":"",startContent:o&&t.jsx(d,{testId:"gh-set-token-indicator",isSet:o})}),t.jsx(p,{onChange:a||(()=>{}),name:"github-host-input",testId:"github-host-input",label:i(r.GITHUB$HOST_LABEL),type:"text",className:"w-full max-w-[680px]",placeholder:"github.com",defaultValue:e||void 0,startContent:e&&e.trim()!==""&&t.jsx(d,{testId:"gh-set-host-indicator",isSet:!0})}),t.jsx(st,{})]})}function ot(){return t.jsx("p",{"data-testid":"gitlab-token-help-anchor",className:"text-xs",children:t.jsx(_,{i18nKey:r.GITLAB$TOKEN_HELP_TEXT,components:[t.jsx("a",{"aria-label":"Gitlab token help link",href:"https://gitlab.com/-/user_settings/personal_access_tokens?name=openhands-app&scopes=api,read_user,read_repository,write_repository",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"gitlab-token-help-anchor-link"),t.jsx("a",{"aria-label":"GitLab token see more link",href:"https://docs.gitlab.com/user/profile/personal_access_tokens/",target:"_blank",className:"underline underline-offset-2",rel:"noopener noreferrer"},"gitlab-token-help-anchor-link-2")]})})}function at({onChange:n,onGitLabHostChange:a,isGitLabTokenSet:o,name:l,gitlabHostSet:e}){const{t:i}=m();return t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(p,{testId:l,name:l,onChange:n,label:i(r.GITLAB$TOKEN_LABEL),type:"password",className:"w-full max-w-[680px]",placeholder:o?"<hidden>":"",startContent:o&&t.jsx(d,{testId:"gl-set-token-indicator",isSet:o})}),t.jsx(p,{onChange:a||(()=>{}),name:"gitlab-host-input",testId:"gitlab-host-input",label:i(r.GITLAB$HOST_LABEL),type:"text",className:"w-full max-w-[680px]",placeholder:"gitlab.com",defaultValue:e||void 0,startContent:e&&e.trim()!==""&&t.jsx(d,{testId:"gl-set-host-indicator",isSet:!0})}),t.jsx(ot,{})]})}function it({slug:n}){const{t:a}=m();return t.jsx("a",{"data-testid":"configure-github-repositories-button",href:`https://github.com/apps/${n}/installations/new`,target:"_blank",rel:"noreferrer noopener",className:"py-9",children:t.jsx(f,{type:"button",variant:"secondary",children:a(r.GITHUB$CONFIGURE_REPOS)})})}function rt(){return t.jsxs("div",{className:"px-11 py-9 flex flex-col gap-12",children:[t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(N,{}),t.jsx(y,{})]}),t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsx(N,{}),t.jsx(y,{})]})]})}const lt=()=>{const n=Z();return X({mutationFn:({providers:a})=>tt.addGitProvider(a),onSuccess:async()=>{await n.invalidateQueries({queryKey:["settings"]})},meta:{disableToast:!0}})};function ut(){const{t:n}=m(),{mutate:a,isPending:o}=lt(),{mutate:l}=z(),{data:e,isLoading:i}=Q(),{providers:b}=et(),{data:u}=q(),[v,x]=c.useState(!1),[C,k]=c.useState(!1),[A,L]=c.useState(!1),[w,h]=c.useState(!1),B=e==null?void 0:e.PROVIDER_TOKENS_SET.github,P=e==null?void 0:e.PROVIDER_TOKENS_SET.gitlab,g=(u==null?void 0:u.APP_MODE)==="saas",S=b.includes("github"),j=b.includes("gitlab"),R=async s=>{var T,G,E,H;if(s.get("disconnect-tokens-button")!==null){l();return}const O=((T=s.get("github-token-input"))==null?void 0:T.toString())||"",K=((G=s.get("gitlab-token-input"))==null?void 0:G.toString())||"",$=((E=s.get("github-host-input"))==null?void 0:E.toString())||"",U=((H=s.get("gitlab-host-input"))==null?void 0:H.toString())||"";a({providers:{github:{token:O,host:$},gitlab:{token:K,host:U}}},{onSuccess:()=>{W(n(r.SETTINGS$SAVED))},onError:M=>{const D=Y(M);J(D||n(r.ERROR$GENERIC))},onSettled:()=>{x(!1),k(!1),L(!1),h(!1)}})},V=!v&&!C&&!A&&!w,I=g&&u.APP_SLUG;return t.jsxs("form",{"data-testid":"git-settings-screen",action:R,className:"flex flex-col h-full justify-between",children:[!i&&t.jsxs("div",{className:"p-9 flex flex-col gap-12",children:[I&&!i&&t.jsx(it,{slug:u.APP_SLUG}),!g&&t.jsx(nt,{name:"github-token-input",isGitHubTokenSet:S,onChange:s=>{x(!!s)},onGitHubHostChange:s=>{h(!!s)},githubHostSet:B}),!g&&t.jsx(at,{name:"gitlab-token-input",isGitLabTokenSet:j,onChange:s=>{k(!!s)},onGitLabHostChange:s=>{h(!!s)},gitlabHostSet:P})]}),i&&t.jsx(rt,{}),t.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:!I&&t.jsxs(t.Fragment,{children:[t.jsx(f,{testId:"disconnect-tokens-button",name:"disconnect-tokens-button",type:"submit",variant:"secondary",isDisabled:!S&&!j,children:"Disconnect Tokens"}),t.jsxs(f,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:o||V,children:[!o&&n("SETTINGS$SAVE_CHANGES"),o&&n("SETTINGS$SAVING")]})]})})]})}const Vt=F(ut);export{Vt as default};
