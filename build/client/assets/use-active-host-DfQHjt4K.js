var T=i=>{throw TypeError(i)};var H=(i,s,e)=>s.has(i)||T("Cannot "+e);var n=(i,s,e)=>(H(i,s,"read from private field"),e?e.call(i):s.get(i)),b=(i,s,e)=>s.has(i)?T("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(i):s.set(i,e),l=(i,s,e,t)=>(H(i,s,"write to private field"),t?t.call(i,e):s.set(i,e),e),y=(i,s,e)=>(H(i,s,"access private method"),e);import{r as w,R as z}from"./router-CPryua6o.js";import{Q as G,a as N,b as V,e as W,c as X,d as Y,s as K,f as U,w as Z,g as $,u as ss}from"./useQuery-C1weQHjG.js";import{S as es,n as M,k as ts,u as rs,a as is,l as ns}from"./open-hands-axios-bwh8x0Ai.js";import{O as os}from"./open-hands-Dol13NBS.js";import{u as us}from"./use-conversation-id-DQbtss6X.js";import{u as as}from"./use-runtime-is-ready-B7fATrrx.js";function _(i,s){const e=new Set(s);return i.filter(t=>!e.has(t))}function cs(i,s,e){const t=i.slice(0);return t[s]=e,t}var v,f,g,Q,d,R,C,S,q,h,k,A,I,P,B,j,hs=(j=class extends es{constructor(s,e,t){super();b(this,h);b(this,v);b(this,f);b(this,g);b(this,Q);b(this,d);b(this,R);b(this,C);b(this,S);b(this,q,[]);l(this,v,s),l(this,Q,t),l(this,g,[]),l(this,d,[]),l(this,f,[]),this.setQueries(e)}onSubscribe(){this.listeners.size===1&&n(this,d).forEach(s=>{s.subscribe(e=>{y(this,h,P).call(this,s,e)})})}onUnsubscribe(){this.listeners.size||this.destroy()}destroy(){this.listeners=new Set,n(this,d).forEach(s=>{s.destroy()})}setQueries(s,e){l(this,g,s),l(this,Q,e),M.batch(()=>{const t=n(this,d),o=y(this,h,I).call(this,n(this,g));l(this,q,o),o.forEach(a=>a.observer.setOptions(a.defaultedQueryOptions));const r=o.map(a=>a.observer),c=r.map(a=>a.getCurrentResult()),u=r.some((a,E)=>a!==t[E]);t.length===r.length&&!u||(l(this,d,r),l(this,f,c),this.hasListeners()&&(_(t,r).forEach(a=>{a.destroy()}),_(r,t).forEach(a=>{a.subscribe(E=>{y(this,h,P).call(this,a,E)})}),y(this,h,B).call(this)))})}getCurrentResult(){return n(this,f)}getQueries(){return n(this,d).map(s=>s.getCurrentQuery())}getObservers(){return n(this,d)}getOptimisticResult(s,e){const t=y(this,h,I).call(this,s),o=t.map(r=>r.observer.getOptimisticResult(r.defaultedQueryOptions));return[o,r=>y(this,h,A).call(this,r??o,e),()=>y(this,h,k).call(this,o,t)]}},v=new WeakMap,f=new WeakMap,g=new WeakMap,Q=new WeakMap,d=new WeakMap,R=new WeakMap,C=new WeakMap,S=new WeakMap,q=new WeakMap,h=new WeakSet,k=function(s,e){return e.map((t,o)=>{const r=s[o];return t.defaultedQueryOptions.notifyOnChangeProps?r:t.observer.trackResult(r,c=>{e.forEach(u=>{u.observer.trackProp(c)})})})},A=function(s,e){return e?((!n(this,R)||n(this,f)!==n(this,S)||e!==n(this,C))&&(l(this,C,e),l(this,S,n(this,f)),l(this,R,ts(n(this,R),e(s)))),n(this,R)):s},I=function(s){const e=new Map(n(this,d).map(o=>[o.options.queryHash,o])),t=[];return s.forEach(o=>{const r=n(this,v).defaultQueryOptions(o),c=e.get(r.queryHash);c?t.push({defaultedQueryOptions:r,observer:c}):t.push({defaultedQueryOptions:r,observer:new G(n(this,v),r)})}),t},P=function(s,e){const t=n(this,d).indexOf(s);t!==-1&&(l(this,f,cs(n(this,f),t,e)),y(this,h,B).call(this))},B=function(){var s;if(this.hasListeners()){const e=n(this,R),t=y(this,h,k).call(this,n(this,f),n(this,q)),o=y(this,h,A).call(this,t,(s=n(this,Q))==null?void 0:s.combine);e!==o&&M.batch(()=>{this.listeners.forEach(r=>{r(n(this,f))})})}},j);function ls({queries:i,...s},e){const t=rs(e),o=N(),r=V(),c=w.useMemo(()=>i.map(p=>{const O=t.defaultQueryOptions(p);return O._optimisticResults=o?"isRestoring":"optimistic",O}),[i,t,o]);c.forEach(p=>{W(p),X(p,r)}),Y(r);const[u]=w.useState(()=>new hs(t,c,s)),[a,E,J]=u.getOptimisticResult(c,s.combine),L=!o&&s.subscribed!==!1;w.useSyncExternalStore(w.useCallback(p=>L?u.subscribe(M.batchCalls(p)):is,[u,L]),()=>u.getCurrentResult(),()=>u.getCurrentResult()),w.useEffect(()=>{u.setQueries(c,s)},[c,s,u]);const D=a.some((p,O)=>K(c[O],p))?a.flatMap((p,O)=>{const m=c[O];if(m){const F=new G(t,m);if(K(m,p))return U(m,F,r);Z(p,o)&&U(m,F,r)}return[]}):[];if(D.length>0)throw Promise.all(D);const x=a.find((p,O)=>{const m=c[O];return m&&$({result:p,errorResetBoundary:r,throwOnError:m.throwOnError,query:t.getQueryCache().get(m.queryHash),suspense:m.suspense})});if(x!=null&&x.error)throw x.error;return E(J())}const vs=()=>{const[i,s]=z.useState(null),{conversationId:e}=us(),t=as(),{data:o}=ss({queryKey:[e,"hosts"],queryFn:async()=>({hosts:await os.getWebHosts(e)}),enabled:t&&!!e,initialData:{hosts:[]},meta:{disableToast:!0}}),c=ls({queries:o.hosts.map(u=>({queryKey:[e,"hosts",u],queryFn:async()=>{try{return await ns.get(u),u}catch{return""}},meta:{disableToast:!0}}))}).map(u=>u.data);return z.useEffect(()=>{const u=c.find(a=>a);s(u||"")},[c]),{activeHost:i}};export{vs as u};
