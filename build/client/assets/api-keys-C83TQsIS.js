import{r as u,w as $}from"./router-CPryua6o.js";import{j as e}from"./ui-Cq19CwDI.js";import{I as s}from"./declaration-DtqZiF37.js";import{u as g,B as d}from"./brand-button-CwmiDb9A.js";import{L as T}from"./loading-spinner-DE-L0vph.js";import{a as y,d as f}from"./custom-toast-handlers-qEjLUNGq.js";import{S as v}from"./settings-input-CLGKJpTa.js";import{M as D}from"./modal-backdrop-DQZszq-6.js";import{o as h,u as _}from"./open-hands-axios-bwh8x0Ai.js";import{u as M}from"./useQuery-C1weQHjG.js";import{u as G}from"./use-config-BEd2J5_T.js";import{u as E}from"./useTranslation-8HK8Q2x7.js";import{T as L}from"./Trans-aXGr5pyD.js";import"./vendor-Csw2ODfV.js";import"./mutation-C1zRO6D6.js";import"./utils-SnfsJp9N.js";import"./index-t-SiDJv5.js";import"./optional-tag-B9pz552A.js";import"./open-hands-Dol13NBS.js";import"./i18nInstance-DBIXdvxg.js";function A({isOpen:n,title:t,width:i="500px",children:a,footer:r}){return n?e.jsx(D,{children:e.jsxs("div",{className:"bg-base-secondary p-6 rounded-xl flex flex-col gap-4 border border-tertiary",style:{width:i},children:[e.jsx("h3",{className:"text-xl font-bold",children:t}),a,e.jsx("div",{className:"w-full flex gap-2 mt-2",children:r})]})}):null}class j{static async getApiKeys(){const{data:t}=await h.get("/api/keys");return Array.isArray(t)?t:[]}static async createApiKey(t){const{data:i}=await h.post("/api/keys",{name:t});return i}static async deleteApiKey(t){await h.delete(`/api/keys/${t}`)}}const S="api-keys";function Y(){const{data:n}=G();return M({queryKey:[S],enabled:(n==null?void 0:n.APP_MODE)==="saas",queryFn:async()=>{const t=await j.getApiKeys();return Array.isArray(t)?t:[]},staleTime:1e3*60*5,gcTime:1e3*60*15})}function k(){const n=_();return g({mutationFn:async t=>j.createApiKey(t),onSuccess:()=>{n.invalidateQueries({queryKey:[S]})}})}function B({isOpen:n,onClose:t,onKeyCreated:i}){const{t:a}=E(),[r,l]=u.useState(""),c=k(),p=async()=>{if(!r.trim()){y(a(s.ERROR$REQUIRED_FIELD));return}try{const m=await c.mutateAsync(r);i(m),f(a(s.SETTINGS$API_KEY_CREATED)),l("")}catch{y(a(s.ERROR$GENERIC))}},N=()=>{l(""),t()},x=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"primary",className:"grow",onClick:p,isDisabled:c.isPending||!r.trim(),children:c.isPending?e.jsx(T,{size:"small"}):a(s.BUTTON$CREATE)}),e.jsx(d,{type:"button",variant:"secondary",className:"grow",onClick:N,isDisabled:c.isPending,children:a(s.BUTTON$CANCEL)})]});return e.jsx(A,{isOpen:n,title:a(s.SETTINGS$CREATE_API_KEY),footer:x,children:e.jsxs("div",{"data-testid":"create-api-key-modal",children:[e.jsx("p",{className:"text-sm text-gray-300",children:a(s.SETTINGS$CREATE_API_KEY_DESCRIPTION)}),e.jsx(v,{testId:"api-key-name-input",label:a(s.SETTINGS$NAME),placeholder:a(s.SETTINGS$API_KEY_NAME_PLACEHOLDER),value:r,onChange:m=>l(m),className:"w-full mt-4",type:"text"})]})})}function F(){const n=_();return g({mutationFn:async t=>{await j.deleteApiKey(t)},onSuccess:()=>{n.invalidateQueries({queryKey:[S]})}})}function U({isOpen:n,keyToDelete:t,onClose:i}){const{t:a}=E(),r=F(),l=async()=>{if(t)try{await r.mutateAsync(t.id),f(a(s.SETTINGS$API_KEY_DELETED)),i()}catch{y(a(s.ERROR$GENERIC))}};if(!t)return null;const c=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"danger",className:"grow",onClick:l,isDisabled:r.isPending,children:r.isPending?e.jsx(T,{size:"small"}):a(s.BUTTON$DELETE)}),e.jsx(d,{type:"button",variant:"secondary",className:"grow",onClick:i,isDisabled:r.isPending,children:a(s.BUTTON$CANCEL)})]});return e.jsx(A,{isOpen:n&&!!t,title:a(s.SETTINGS$DELETE_API_KEY),footer:c,children:e.jsx("div",{"data-testid":"delete-api-key-modal",children:e.jsx("p",{className:"text-sm",children:a(s.SETTINGS$DELETE_API_KEY_CONFIRMATION,{name:t.name})})})})}function q({isOpen:n,newlyCreatedKey:t,onClose:i}){const{t:a}=E(),r=()=>{t&&(navigator.clipboard.writeText(t.key),f(a(s.SETTINGS$API_KEY_COPIED)))};if(!t)return null;const l=e.jsxs(e.Fragment,{children:[e.jsx(d,{type:"button",variant:"primary",onClick:r,children:a(s.BUTTON$COPY_TO_CLIPBOARD)}),e.jsx(d,{type:"button",variant:"secondary",onClick:i,children:a(s.BUTTON$CLOSE)})]});return e.jsx(A,{isOpen:n&&!!t,title:a(s.SETTINGS$API_KEY_CREATED),width:"600px",footer:l,children:e.jsxs("div",{"data-testid":"new-api-key-modal",children:[e.jsx("p",{className:"text-sm",children:a(s.SETTINGS$API_KEY_WARNING)}),e.jsx("div",{className:"bg-base-tertiary p-4 rounded-md font-mono text-sm break-all mt-4",children:t.key})]})})}function Q(){const{t:n}=E(),{data:t=[],isLoading:i,error:a}=Y(),[r,l]=u.useState(!1),[c,p]=u.useState(!1),[N,x]=u.useState(null),[m,C]=u.useState(null),[b,I]=u.useState(!1);a&&y(n(s.ERROR$GENERIC));const O=o=>{C(o),l(!1),I(!0)},R=()=>{l(!1)},w=()=>{p(!1),x(null)},P=()=>{I(!1),C(null)},K=o=>o?new Date(o).toLocaleString():"Never";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(d,{type:"button",variant:"primary",onClick:()=>l(!0),children:n(s.SETTINGS$CREATE_API_KEY)})}),e.jsx("p",{className:"text-sm text-gray-300",children:e.jsx(L,{i18nKey:s.SETTINGS$API_KEYS_DESCRIPTION,components:{a:e.jsx("a",{href:"https://docs.all-hands.dev/usage/cloud/cloud-api",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"API documentation"})}})}),i&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(T,{size:"large"})}),!i&&Array.isArray(t)&&t.length>0&&e.jsx("div",{className:"border border-tertiary rounded-md overflow-hidden",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-base-tertiary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$NAME)}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$CREATED_AT)}),e.jsx("th",{className:"text-left p-3 text-sm font-medium",children:n(s.SETTINGS$LAST_USED)}),e.jsx("th",{className:"text-right p-3 text-sm font-medium",children:n(s.SETTINGS$ACTIONS)})]})}),e.jsx("tbody",{children:t.map(o=>e.jsxs("tr",{className:"border-t border-tertiary",children:[e.jsx("td",{className:"p-3 text-sm",children:o.name}),e.jsx("td",{className:"p-3 text-sm",children:K(o.created_at)}),e.jsx("td",{className:"p-3 text-sm",children:K(o.last_used_at)}),e.jsx("td",{className:"p-3 text-right",children:e.jsx("button",{type:"button",className:"underline",onClick:()=>{x(o),p(!0)},children:n(s.BUTTON$DELETE)})})]},o.id))})]})})]}),e.jsx(B,{isOpen:r,onClose:R,onKeyCreated:O}),e.jsx(U,{isOpen:c,keyToDelete:N,onClose:w}),e.jsx(q,{isOpen:b,newlyCreatedKey:m,onClose:P})]})}function z(){return e.jsx("div",{className:"flex flex-col grow overflow-auto p-9",children:e.jsx(Q,{})})}const xe=$(z);export{xe as default};
