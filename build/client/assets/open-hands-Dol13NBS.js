var I=Object.defineProperty;var G=a=>{throw TypeError(a)};var K=(a,t,e)=>t in a?I(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var x=(a,t,e)=>K(a,typeof t!="symbol"?t+"":t,e),q=(a,t,e)=>t.has(a)||G("Cannot "+e);var r=(a,t,e)=>(q(a,t,"read from private field"),e?e.call(a):t.get(a)),y=(a,t,e)=>t.has(a)?G("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),l=(a,t,e,s)=>(q(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e),g=(a,t,e)=>(q(a,t,"access private method"),e);import{R as P,r as Q,a as M,b as E,s as j,d as B,t as z,c as W,n as V,i as k,e as X,f as Z,o as i,A as J}from"./open-hands-axios-bwh8x0Ai.js";var w,S,u,m,c,R,b,h,f,O,st=(O=class extends P{constructor(t){super();y(this,h);y(this,w);y(this,S);y(this,u);y(this,m);y(this,c);y(this,R);y(this,b);l(this,b,!1),l(this,R,t.defaultOptions),this.setOptions(t.options),this.observers=[],l(this,m,t.client),l(this,u,r(this,m).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,l(this,w,N(this.options)),this.state=t.state??r(this,w),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=r(this,c))==null?void 0:t.promise}setOptions(t){this.options={...r(this,R),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&r(this,u).remove(this)}setData(t,e){const s=Q(this.state.data,t,this.options);return g(this,h,f).call(this,{data:s,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),s}setState(t,e){g(this,h,f).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var s,o;const e=(s=r(this,c))==null?void 0:s.promise;return(o=r(this,c))==null||o.cancel(t),e?e.then(M).catch(M):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(r(this,w))}isActive(){return this.observers.some(t=>E(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===j||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(t=>B(t.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(t=0){return this.state.data===void 0?!0:t==="static"?!1:this.state.isInvalidated?!0:!z(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=r(this,c))==null||e.continue()}onOnline(){var e;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=r(this,c))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),r(this,u).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(r(this,c)&&(r(this,b)?r(this,c).cancel({revert:!0}):r(this,c).cancelRetry()),this.scheduleGc()),r(this,u).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||g(this,h,f).call(this,{type:"invalidate"})}fetch(t,e){var A,H,_;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(r(this,c))return r(this,c).continueRetry(),r(this,c).promise}if(t&&this.setOptions(t),!this.options.queryFn){const n=this.observers.find(d=>d.options.queryFn);n&&this.setOptions(n.options)}const s=new AbortController,o=n=>{Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(l(this,b,!0),s.signal)})},D=()=>{const n=X(this.options,e),v=(()=>{const C={client:r(this,m),queryKey:this.queryKey,meta:this.meta};return o(C),C})();return l(this,b,!1),this.options.persister?this.options.persister(n,v,this):n(v)},p=(()=>{const n={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:r(this,m),state:this.state,fetchFn:D};return o(n),n})();(A=this.options.behavior)==null||A.onFetch(p,this),l(this,S,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((H=p.fetchOptions)==null?void 0:H.meta))&&g(this,h,f).call(this,{type:"fetch",meta:(_=p.fetchOptions)==null?void 0:_.meta});const U=n=>{var d,v,C,F;k(n)&&n.silent||g(this,h,f).call(this,{type:"error",error:n}),k(n)||((v=(d=r(this,u).config).onError)==null||v.call(d,n,this),(F=(C=r(this,u).config).onSettled)==null||F.call(C,this.state.data,n,this)),this.scheduleGc()};return l(this,c,W({initialPromise:e==null?void 0:e.initialPromise,fn:p.fetchFn,abort:s.abort.bind(s),onSuccess:n=>{var d,v,C,F;if(n===void 0){U(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(n)}catch(T){U(T);return}(v=(d=r(this,u).config).onSuccess)==null||v.call(d,n,this),(F=(C=r(this,u).config).onSettled)==null||F.call(C,n,this.state.error,this),this.scheduleGc()},onError:U,onFail:(n,d)=>{g(this,h,f).call(this,{type:"failed",failureCount:n,error:d})},onPause:()=>{g(this,h,f).call(this,{type:"pause"})},onContinue:()=>{g(this,h,f).call(this,{type:"continue"})},retry:p.options.retry,retryDelay:p.options.retryDelay,networkMode:p.options.networkMode,canRun:()=>!0})),r(this,c).start()}},w=new WeakMap,S=new WeakMap,u=new WeakMap,m=new WeakMap,c=new WeakMap,R=new WeakMap,b=new WeakMap,h=new WeakSet,f=function(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,...L(s.data,this.options),fetchMeta:t.meta??null};case"success":return{...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return k(o)&&o.revert&&r(this,S)?{...r(this,S),fetchStatus:"idle"}:{...s,error:o,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),V.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),r(this,u).notify({query:this,type:"updated",action:t})})},O);function L(a,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:Z(t.networkMode)?"fetching":"paused",...a===void 0&&{error:null,status:"pending"}}}function N(a){const t=typeof a.initialData=="function"?a.initialData():a.initialData,e=t!==void 0,s=e?typeof a.initialDataUpdatedAt=="function"?a.initialDataUpdatedAt():a.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}class Y{static getCurrentConversation(){return this.currentConversation}static setCurrentConversation(t){this.currentConversation=t}static getConversationUrl(t){var e;return((e=this.currentConversation)==null?void 0:e.conversation_id)===t&&this.currentConversation.url?this.currentConversation.url:`/api/conversations/${t}`}static async getModels(){const{data:t}=await i.get("/api/options/models");return t}static async getAgents(){const{data:t}=await i.get("/api/options/agents");return t}static async getSecurityAnalyzers(){const{data:t}=await i.get("/api/options/security-analyzers");return t}static async getConfig(){const{data:t}=await i.get("/api/options/config");return t}static getConversationHeaders(){var s;const t=new J,e=(s=this.currentConversation)==null?void 0:s.session_api_key;return e&&t.set("X-Session-API-Key",e),t}static async submitFeedback(t,e){const s=`/api/conversations/${t}/submit-feedback`,{data:o}=await i.post(s,e);return o}static async authenticate(t){return t==="oss"||await i.post("/api/authenticate"),!0}static async getWorkspaceZip(t){const e=`${this.getConversationUrl(t)}/zip-directory`;return(await i.get(e,{responseType:"blob",headers:this.getConversationHeaders()})).data}static async getWebHosts(t){const e=`${this.getConversationUrl(t)}/web-hosts`,s=await i.get(e,{headers:this.getConversationHeaders()});return Object.keys(s.data.hosts)}static async getGitHubAccessToken(t){const{data:e}=await i.post("/api/keycloak/callback",{code:t});return e}static async getVSCodeUrl(t){const e=`${this.getConversationUrl(t)}/vscode-url`,{data:s}=await i.get(e,{headers:this.getConversationHeaders()});return s}static async getRuntimeId(t){const e=`${this.getConversationUrl(t)}/config`,{data:s}=await i.get(e,{headers:this.getConversationHeaders()});return s}static async getUserConversations(){const{data:t}=await i.get("/api/conversations?limit=20");return t.results}static async deleteUserConversation(t){await i.delete(`/api/conversations/${t}`)}static async createConversation(t,e,s,o,D,$,p){const U={repository:t,git_provider:e,selected_branch:p,initial_user_msg:s,image_urls:o,replay_json:D,suggested_task:$},{data:A}=await i.post("/api/conversations",U);return A}static async getConversation(t){const{data:e}=await i.get(`/api/conversations/${t}`);return e}static async startConversation(t){const{data:e}=await i.post(`/api/conversations/${t}/start`);return e}static async stopConversation(t){const{data:e}=await i.post(`/api/conversations/${t}/stop`);return e}static async getSettings(){const{data:t}=await i.get("/api/settings");return t}static async saveSettings(t){return(await i.post("/api/settings",t)).status===200}static async createCheckoutSession(t){const{data:e}=await i.post("/api/billing/create-checkout-session",{amount:t});return e.redirect_url}static async createBillingSessionResponse(){const{data:t}=await i.post("/api/billing/create-customer-setup-session");return t.redirect_url}static async getBalance(){const{data:t}=await i.get("/api/billing/credits");return t.credits}static async getGitUser(){const t=await i.get("/api/user/info"),{data:e}=t;return{id:e.id,login:e.login,avatar_url:e.avatar_url,company:e.company,name:e.name,email:e.email}}static async searchGitRepositories(t,e=5){return(await i.get("/api/user/search/repositories",{params:{query:t,per_page:e}})).data}static async getTrajectory(t){const e=`${this.getConversationUrl(t)}/trajectory`,{data:s}=await i.get(e,{headers:this.getConversationHeaders()});return s}static async logout(t){const e=t==="saas"?"/api/logout":"/api/unset-provider-tokens";await i.post(e)}static async getGitChanges(t){const e=`${this.getConversationUrl(t)}/git/changes`,{data:s}=await i.get(e,{headers:this.getConversationHeaders()});return s}static async getGitChangeDiff(t,e){const s=`${this.getConversationUrl(t)}/git/diff`,{data:o}=await i.get(s,{params:{path:e},headers:this.getConversationHeaders()});return o}static async retrieveUserGitRepositories(){const{data:t}=await i.get("/api/user/repositories",{params:{sort:"pushed"}});return t}static async getRepositoryBranches(t){const{data:e}=await i.get(`/api/user/repository/branches?repository=${encodeURIComponent(t)}`);return e}static async getMicroagents(t){const e=`${this.getConversationUrl(t)}/microagents`,{data:s}=await i.get(e,{headers:this.getConversationHeaders()});return s}static async getMicroagentPrompt(t,e){const{data:s}=await i.get(`/api/conversations/${t}/remember_prompt`,{params:{event_id:e}});return s.prompt}}x(Y,"currentConversation",null);export{Y as O,st as Q,L as f};
