import{w as D,R as u}from"./router-CPryua6o.js";import{j as e}from"./ui-Cq19CwDI.js";import{u as F}from"./use-save-settings-Ds-eMOrk.js";import{u as K,D as M}from"./use-settings-DphRp9S7.js";import{A as d}from"./index-NLfq4YkK.js";import{B as Y}from"./brand-button-CwmiDb9A.js";import{S as v,a as N}from"./switch-skeleton-CAK4PGjj.js";import{I as i}from"./declaration-DtqZiF37.js";import{S as q}from"./settings-dropdown-input-iBqLcpmc.js";import{u as w}from"./useTranslation-8HK8Q2x7.js";import{h as z}from"./handle-capture-consent-D5Lep1P7.js";import{a as J,d as Q}from"./custom-toast-handlers-qEjLUNGq.js";import{r as W}from"./retrieve-axios-error-message-CoJTAmT2.js";import{I as X}from"./input-skeleton-BqX4Bc0H.js";import{u as Z}from"./use-config-BEd2J5_T.js";import"./vendor-Csw2ODfV.js";import"./open-hands-axios-bwh8x0Ai.js";import"./module-eUUeIAmF.js";import"./open-hands-Dol13NBS.js";import"./useQuery-C1weQHjG.js";import"./i18next-Bhc83OLH.js";import"./i18nInstance-DBIXdvxg.js";import"./mutation-C1zRO6D6.js";import"./utils-SnfsJp9N.js";import"./optional-tag-B9pz552A.js";import"./index-t-SiDJv5.js";function tt({defaultKey:s,onChange:g,name:o}){const{t}=w();return e.jsx(q,{testId:o,name:o,onInputChange:g,label:t(i.SETTINGS$LANGUAGE),items:d.map(l=>({key:l.value,label:l.label})),defaultSelectedKey:s,isClearable:!1,wrapperClassName:"w-full max-w-[680px]"})}function et(){return e.jsxs("div",{"data-testid":"app-settings-skeleton",className:"px-11 py-9 flex flex-col gap-6",children:[e.jsx(X,{}),e.jsx(v,{}),e.jsx(v,{})]})}function at(){const{t:s}=w(),{mutate:g,isPending:o}=F(),{data:t,isLoading:l}=K(),{data:p}=Z(),[L,m]=u.useState(!1),[R,I]=u.useState(!1),[y,A]=u.useState(!1),[G,T]=u.useState(!1),j=a=>{var C,O,_,b,x;const n=(C=a.get("language-input"))==null?void 0:C.toString(),S=((O=d.find(({label:f})=>f===n))==null?void 0:O.value)||M.LANGUAGE,r=((_=a.get("enable-analytics-switch"))==null?void 0:_.toString())==="on",c=((b=a.get("enable-sound-notifications-switch"))==null?void 0:b.toString())==="on",k=((x=a.get("enable-proactive-conversations-switch"))==null?void 0:x.toString())==="on";g({LANGUAGE:S,user_consents_to_analytics:r,ENABLE_SOUND_NOTIFICATIONS:c,ENABLE_PROACTIVE_CONVERSATION_STARTERS:k},{onSuccess:()=>{z(r),Q(s(i.SETTINGS$SAVED))},onError:f=>{const $=W(f);J($||s(i.ERROR$GENERIC))},onSettled:()=>{m(!1),I(!1),A(!1),T(!1)}})},H=a=>{var S,r;const n=(S=d.find(({label:c})=>c===a))==null?void 0:S.label,h=(r=d.find(({value:c})=>c===(t==null?void 0:t.LANGUAGE)))==null?void 0:r.label;m(n!==h)},V=a=>{const n=!!(t!=null&&t.USER_CONSENTS_TO_ANALYTICS);I(a!==n)},P=a=>{const n=!!(t!=null&&t.ENABLE_SOUND_NOTIFICATIONS);A(a!==n)},U=a=>{const n=!!(t!=null&&t.ENABLE_PROACTIVE_CONVERSATION_STARTERS);T(a!==n)},B=!L&&!R&&!y&&!G,E=!t||l||o;return e.jsxs("form",{"data-testid":"app-settings-screen",action:j,className:"flex flex-col h-full justify-between",children:[E&&e.jsx(et,{}),!E&&e.jsxs("div",{className:"p-9 flex flex-col gap-6",children:[e.jsx(tt,{name:"language-input",defaultKey:t.LANGUAGE,onChange:H}),e.jsx(N,{testId:"enable-analytics-switch",name:"enable-analytics-switch",defaultIsToggled:!!t.USER_CONSENTS_TO_ANALYTICS,onToggle:V,children:s(i.ANALYTICS$ENABLE)}),e.jsx(N,{testId:"enable-sound-notifications-switch",name:"enable-sound-notifications-switch",defaultIsToggled:!!t.ENABLE_SOUND_NOTIFICATIONS,onToggle:P,children:s(i.SETTINGS$SOUND_NOTIFICATIONS)}),(p==null?void 0:p.APP_MODE)==="saas"&&e.jsx(N,{testId:"enable-proactive-conversations-switch",name:"enable-proactive-conversations-switch",defaultIsToggled:!!t.ENABLE_PROACTIVE_CONVERSATION_STARTERS,onToggle:U,children:s(i.SETTINGS$PROACTIVE_CONVERSATION_STARTERS)})]}),e.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:e.jsxs(Y,{testId:"submit-button",variant:"primary",type:"submit",isDisabled:o||B,children:[!o&&s("SETTINGS$SAVE_CHANGES"),o&&s("SETTINGS$SAVING")]})})]})}const wt=D(at);export{wt as default};
