var L=t=>{throw TypeError(t)};var $=(t,e,s)=>e.has(t)||L("Cannot "+s);var r=(t,e,s)=>($(t,e,"read from private field"),s?s.call(t):e.get(t)),c=(t,e,s)=>e.has(t)?L("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),o=(t,e,s,a)=>($(t,e,"write to private field"),a?a.call(t,s):e.set(t,s),s);var q=(t,e,s,a)=>({set _(n){o(t,e,n,s)},get _(){return r(t,e,a)}});import{c as Q,a as we,b as Ae}from"./redux-toolkit.modern-C17kwIqd.js";import{A as Ee}from"./agent-state-u5yf9HVO.js";import{b as De}from"./browser-slice-DCstnZW4.js";import{i as Fe}from"./initial-query-slice-kALvhVye.js";import{i as W}from"./i18next-Bhc83OLH.js";import{I as V}from"./declaration-DtqZiF37.js";import{r as X}from"./retrieve-axios-error-message-CoJTAmT2.js";import{a as Y}from"./custom-toast-handlers-qEjLUNGq.js";import{S as de,w as he,n as l,x as Z,y as x,a as y,e as Ie,z as qe,B as Re,v as _e,C as ee,d as te,D as Ke,h as se,E as ae,s as Te}from"./open-hands-axios-bwh8x0Ai.js";import{Q as He}from"./open-hands-Dol13NBS.js";import{M as Ne}from"./mutation-C1zRO6D6.js";var p,oe,fe=(oe=class extends de{constructor(e={}){super();c(this,p);this.config=e,o(this,p,new Map)}build(e,s,a){const n=s.queryKey,i=s.queryHash??he(n,s);let d=this.get(i);return d||(d=new He({client:e,queryKey:n,queryHash:i,options:e.defaultQueryOptions(s),state:a,defaultOptions:e.getQueryDefaults(n)}),this.add(d)),d}add(e){r(this,p).has(e.queryHash)||(r(this,p).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const s=r(this,p).get(e.queryHash);s&&(e.destroy(),s===e&&r(this,p).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){l.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return r(this,p).get(e)}getAll(){return[...r(this,p).values()]}find(e){const s={exact:!0,...e};return this.getAll().find(a=>Z(s,a))}findAll(e={}){const s=this.getAll();return Object.keys(e).length>0?s.filter(a=>Z(e,a)):s}notify(e){l.batch(()=>{this.listeners.forEach(s=>{s(e)})})}onFocus(){l.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){l.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},p=new WeakMap,oe),m,f,D,ce,pe=(ce=class extends de{constructor(e={}){super();c(this,m);c(this,f);c(this,D);this.config=e,o(this,m,new Set),o(this,f,new Map),o(this,D,0)}build(e,s,a){const n=new Ne({mutationCache:this,mutationId:++q(this,D)._,options:e.defaultMutationOptions(s),state:a});return this.add(n),n}add(e){r(this,m).add(e);const s=R(e);if(typeof s=="string"){const a=r(this,f).get(s);a?a.push(e):r(this,f).set(s,[e])}this.notify({type:"added",mutation:e})}remove(e){if(r(this,m).delete(e)){const s=R(e);if(typeof s=="string"){const a=r(this,f).get(s);if(a)if(a.length>1){const n=a.indexOf(e);n!==-1&&a.splice(n,1)}else a[0]===e&&r(this,f).delete(s)}}this.notify({type:"removed",mutation:e})}canRun(e){const s=R(e);if(typeof s=="string"){const a=r(this,f).get(s),n=a==null?void 0:a.find(i=>i.state.status==="pending");return!n||n===e}else return!0}runNext(e){var a;const s=R(e);if(typeof s=="string"){const n=(a=r(this,f).get(s))==null?void 0:a.find(i=>i!==e&&i.state.isPaused);return(n==null?void 0:n.continue())??Promise.resolve()}else return Promise.resolve()}clear(){l.batch(()=>{r(this,m).forEach(e=>{this.notify({type:"removed",mutation:e})}),r(this,m).clear(),r(this,f).clear()})}getAll(){return Array.from(r(this,m))}find(e){const s={exact:!0,...e};return this.getAll().find(a=>x(s,a))}findAll(e={}){return this.getAll().filter(s=>x(e,s))}notify(e){l.batch(()=>{this.listeners.forEach(s=>{s(e)})})}resumePausedMutations(){const e=this.getAll().filter(s=>s.state.isPaused);return l.batch(()=>Promise.all(e.map(s=>s.continue().catch(y))))}},m=new WeakMap,f=new WeakMap,D=new WeakMap,ce);function R(t){var e;return(e=t.options.scope)==null?void 0:e.id}function re(t){return{onFetch:(e,s)=>{var T,H,N,j,U;const a=e.options,n=(N=(H=(T=e.fetchOptions)==null?void 0:T.meta)==null?void 0:H.fetchMore)==null?void 0:N.direction,i=((j=e.state.data)==null?void 0:j.pages)||[],d=((U=e.state.data)==null?void 0:U.pageParams)||[];let A={pages:[],pageParams:[]},F=0;const K=async()=>{let b=!1;const I=h=>{Object.defineProperty(h,"signal",{enumerable:!0,get:()=>(e.signal.aborted?b=!0:e.signal.addEventListener("abort",()=>{b=!0}),e.signal)})},Pe=Ie(e.options,e.fetchOptions),z=async(h,g,E)=>{if(b)return Promise.reject();if(g==null&&h.pages.length)return Promise.resolve(h);const Me=(()=>{const k={client:e.client,queryKey:e.queryKey,pageParam:g,direction:E?"backward":"forward",meta:e.options.meta};return I(k),k})(),Ce=await Pe(Me),{maxPages:B}=e.options,G=E?qe:Re;return{pages:G(h.pages,Ce,B),pageParams:G(h.pageParams,g,B)}};if(n&&i.length){const h=n==="backward",g=h?je:ne,E={pages:i,pageParams:d},J=g(a,E);A=await z(E,J,h)}else{const h=t??i.length;do{const g=F===0?d[0]??a.initialPageParam:ne(a,A);if(F>0&&g==null)break;A=await z(A,g),F++}while(F<h)}return A};e.options.persister?e.fetchFn=()=>{var b,I;return(I=(b=e.options).persister)==null?void 0:I.call(b,K,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},s)}:e.fetchFn=K}}}function ne(t,{pages:e,pageParams:s}){const a=e.length-1;return e.length>0?t.getNextPageParam(e[a],e,s[a],s):void 0}function je(t,{pages:e,pageParams:s}){var a;return e.length>0?(a=t.getPreviousPageParam)==null?void 0:a.call(t,e[0],e,s[0],s):void 0}var u,v,O,P,M,S,C,w,le,Ue=(le=class{constructor(t={}){c(this,u);c(this,v);c(this,O);c(this,P);c(this,M);c(this,S);c(this,C);c(this,w);o(this,u,t.queryCache||new fe),o(this,v,t.mutationCache||new pe),o(this,O,t.defaultOptions||{}),o(this,P,new Map),o(this,M,new Map),o(this,S,0)}mount(){q(this,S)._++,r(this,S)===1&&(o(this,C,_e.subscribe(async t=>{t&&(await this.resumePausedMutations(),r(this,u).onFocus())})),o(this,w,ee.subscribe(async t=>{t&&(await this.resumePausedMutations(),r(this,u).onOnline())})))}unmount(){var t,e;q(this,S)._--,r(this,S)===0&&((t=r(this,C))==null||t.call(this),o(this,C,void 0),(e=r(this,w))==null||e.call(this),o(this,w,void 0))}isFetching(t){return r(this,u).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return r(this,v).findAll({...t,status:"pending"}).length}getQueryData(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=r(this,u).get(e.queryHash))==null?void 0:s.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),s=r(this,u).build(this,e),a=s.state.data;return a===void 0?this.fetchQuery(t):(t.revalidateIfStale&&s.isStaleByTime(te(e.staleTime,s))&&this.prefetchQuery(e),Promise.resolve(a))}getQueriesData(t){return r(this,u).findAll(t).map(({queryKey:e,state:s})=>{const a=s.data;return[e,a]})}setQueryData(t,e,s){const a=this.defaultQueryOptions({queryKey:t}),n=r(this,u).get(a.queryHash),i=n==null?void 0:n.state.data,d=Ke(e,i);if(d!==void 0)return r(this,u).build(this,a).setData(d,{...s,manual:!0})}setQueriesData(t,e,s){return l.batch(()=>r(this,u).findAll(t).map(({queryKey:a})=>[a,this.setQueryData(a,e,s)]))}getQueryState(t){var s;const e=this.defaultQueryOptions({queryKey:t});return(s=r(this,u).get(e.queryHash))==null?void 0:s.state}removeQueries(t){const e=r(this,u);l.batch(()=>{e.findAll(t).forEach(s=>{e.remove(s)})})}resetQueries(t,e){const s=r(this,u);return l.batch(()=>(s.findAll(t).forEach(a=>{a.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const s={revert:!0,...e},a=l.batch(()=>r(this,u).findAll(t).map(n=>n.cancel(s)));return Promise.all(a).then(y).catch(y)}invalidateQueries(t,e={}){return l.batch(()=>(r(this,u).findAll(t).forEach(s=>{s.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const s={...e,cancelRefetch:e.cancelRefetch??!0},a=l.batch(()=>r(this,u).findAll(t).filter(n=>!n.isDisabled()&&!n.isStatic()).map(n=>{let i=n.fetch(void 0,s);return s.throwOnError||(i=i.catch(y)),n.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(a).then(y)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const s=r(this,u).build(this,e);return s.isStaleByTime(te(e.staleTime,s))?s.fetch(e):Promise.resolve(s.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(y).catch(y)}fetchInfiniteQuery(t){return t.behavior=re(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(y).catch(y)}ensureInfiniteQueryData(t){return t.behavior=re(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return ee.isOnline()?r(this,v).resumePausedMutations():Promise.resolve()}getQueryCache(){return r(this,u)}getMutationCache(){return r(this,v)}getDefaultOptions(){return r(this,O)}setDefaultOptions(t){o(this,O,t)}setQueryDefaults(t,e){r(this,P).set(se(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...r(this,P).values()],s={};return e.forEach(a=>{ae(t,a.queryKey)&&Object.assign(s,a.defaultOptions)}),s}setMutationDefaults(t,e){r(this,M).set(se(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...r(this,M).values()],s={};return e.forEach(a=>{ae(t,a.mutationKey)&&Object.assign(s,a.defaultOptions)}),s}defaultQueryOptions(t){if(t._defaulted)return t;const e={...r(this,O).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=he(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Te&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...r(this,O).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){r(this,u).clear(),r(this,v).clear()}},u=new WeakMap,v=new WeakMap,O=new WeakMap,P=new WeakMap,M=new WeakMap,S=new WeakMap,C=new WeakMap,w=new WeakMap,le);const ye=Q({name:"agent",initialState:{curAgentState:Ee.LOADING},reducers:{setCurrentAgentState:(t,e)=>{t.curAgentState=e.payload}}}),{setCurrentAgentState:mt}=ye.actions,ze=ye.reducer,Je={code:"",path:"",refreshID:0,fileStates:[]},me=Q({name:"code",initialState:Je,reducers:{setCode:(t,e)=>{t.code=e.payload},setActiveFilepath:(t,e)=>{t.path=e.payload},setRefreshID:(t,e)=>{t.refreshID=e.payload},setFileStates:(t,e)=>{t.fileStates=e.payload},addOrUpdateFileState:(t,e)=>{const{path:s,unsavedContent:a,savedContent:n}=e.payload,i=t.fileStates.filter(d=>d.path!==s);i.push({path:s,savedContent:n,unsavedContent:a}),t.fileStates=i},removeFileState:(t,e)=>{const s=e.payload;t.fileStates=t.fileStates.filter(a=>a.path!==s)}}}),{setCode:gt,setActiveFilepath:vt,setRefreshID:Ot,addOrUpdateFileState:St,removeFileState:Qt,setFileStates:bt}=me.actions,Be=me.reducer,Ge={changed:{}},ge=Q({name:"fileState",initialState:Ge,reducers:{setChanged(t,e){const{path:s,changed:a}=e.payload;t.changed[s]=a}}}),{setChanged:Pt}=ge.actions,ke=ge.reducer,Le=[],ve=Q({name:"command",initialState:{commands:Le},reducers:{appendInput:(t,e)=>{t.commands.push({content:e.payload,type:"input"})},appendOutput:(t,e)=>{t.commands.push({content:e.payload,type:"output"})},clearTerminal:t=>{t.commands=[]}}}),{appendInput:Mt,appendOutput:Ct,clearTerminal:wt}=ve.actions,$e=ve.reducer,We=[],Oe=Q({name:"jupyter",initialState:{cells:We},reducers:{appendJupyterInput:(t,e)=>{t.cells.push({content:e.payload,type:"input"})},appendJupyterOutput:(t,e)=>{t.cells.push({content:e.payload.content,type:"output",imageUrls:e.payload.imageUrls})},clearJupyter:t=>{t.cells=[]}}}),{appendJupyterInput:At,appendJupyterOutput:Et,clearJupyter:Dt}=Oe.actions,Ve=Oe.reducer;var Xe=(t=>(t[t.UNKNOWN=-1]="UNKNOWN",t[t.LOW=0]="LOW",t[t.MEDIUM=1]="MEDIUM",t[t.HIGH=2]="HIGH",t))(Xe||{});const Ye=[],Se=Q({name:"securityAnalyzer",initialState:{logs:Ye},reducers:{appendSecurityAnalyzerInput:(t,e)=>{const s={id:e.payload.id,content:e.payload.args.command||e.payload.args.code||e.payload.args.content||e.payload.message,security_risk:e.payload.args.security_risk,confirmation_state:e.payload.args.confirmation_state,confirmed_changed:!1},a=t.logs.find(n=>n.id===s.id||n.confirmation_state==="awaiting_confirmation"&&n.content===s.content);a?a.confirmation_state!==s.confirmation_state&&(a.confirmation_state=s.confirmation_state,a.confirmed_changed=!0):t.logs.push(s)}}}),{appendSecurityAnalyzerInput:Ft}=Se.actions,Ze=Se.reducer,xe={status_update:!0,type:"info",id:"",message:""},Qe=Q({name:"status",initialState:{curStatusMessage:xe},reducers:{setCurStatusMessage:(t,e)=>{t.curStatusMessage=e.payload}}}),{setCurStatusMessage:It}=Qe.actions,et=Qe.reducer,tt={cost:null,usage:null},be=Q({name:"metrics",initialState:tt,reducers:{setMetrics:(t,e)=>{t.cost=e.payload.cost,t.usage=e.payload.usage}}}),{setMetrics:qt}=be.actions,st=be.reducer,at=we({fileState:ke,initialQuery:Fe,browser:De,code:Be,cmd:$e,agent:ze,jupyter:Ve,securityAnalyzer:Ze,status:et,metrics:st}),Rt=Ae({reducer:at}),ie=(t,e)=>{var s;(((s=t==null?void 0:t.response)==null?void 0:s.status)===401||(t==null?void 0:t.status)===401)&&e.invalidateQueries({queryKey:["user","authenticated"]})},_=new Set,ue=new Ue({queryCache:new fe({onError:(t,e)=>{var a;if(e.queryKey[0]==="user"&&e.queryKey[1]==="authenticated"||ie(t,ue),!((a=e.meta)!=null&&a.disableToast)){const n=X(t);_.has(n||"")||(Y(n||W.t(V.ERROR$GENERIC)),_.add(n),setTimeout(()=>{_.delete(n)},3e3))}}}),mutationCache:new pe({onError:(t,e,s,a)=>{var n;if(ie(t,ue),!((n=a==null?void 0:a.meta)!=null&&n.disableToast)){const i=X(t);Y(i||W.t(V.ERROR$GENERIC))}}})});export{Xe as A,mt as a,Et as b,Ct as c,qt as d,Mt as e,Ft as f,It as g,wt as h,Dt as i,ue as q,Rt as s};
