import{R as f,r as u,N as ee,a as M,e as ue,b as me,u as R,y as he,w as fe,O as pe,z as Ee,A as xe}from"./router-CPryua6o.js";import{j as e,t as Ce,R as Ne}from"./ui-Cq19CwDI.js";import{I as l}from"./declaration-DtqZiF37.js";import"./index-NLfq4YkK.js";import{D as ge,a as b,u as $}from"./use-settings-DphRp9S7.js";import{u as w,a as Se}from"./use-config-BEd2J5_T.js";import{u as te}from"./useQuery-C1weQHjG.js";import{u as se}from"./module-eUUeIAmF.js";import{O as D}from"./open-hands-Dol13NBS.js";import{u as Ae}from"./use-user-providers-Ddi7hhkA.js";import{L as k}from"./loading-spinner-DE-L0vph.js";import{c as I}from"./utils-SnfsJp9N.js";import{u as p}from"./useTranslation-8HK8Q2x7.js";import{u as ne,C as _e,a as Ie,B as Le,M as T,b as G,c as ae,d as J,e as Te}from"./conversation-card-CaIwYuXr.js";import{S as P}from"./all-hands-logo-K5d9hBiw.js";import{S as ve}from"./settings-ssoj6VGC.js";import{a as je}from"./index-PZ0N6KKr.js";import{M as Oe,o as Me,H as we,u as ye}from"./help-link-yrwnyn8z.js";import{M as A}from"./modal-backdrop-DQZszq-6.js";import{B as L,u as oe}from"./brand-button-CwmiDb9A.js";import{K as Re}from"./key-status-icon-DfYhW2cB.js";import{S as be}from"./settings-input-CLGKJpTa.js";import{u as B}from"./use-save-settings-Ds-eMOrk.js";import{u as De}from"./open-hands-axios-bwh8x0Ai.js";import{u as Pe,g as Ue,L as U,s as $e,a as q}from"./use-logout-1cyMtnsa.js";import{a as re,d as ke}from"./custom-toast-handlers-qEjLUNGq.js";import{h as le}from"./handle-capture-consent-D5Lep1P7.js";import{u as Ge}from"./use-balance-DbwlCdnQ.js";import{T as Be}from"./Trans-aXGr5pyD.js";import{i as Fe}from"./i18next-Bhc83OLH.js";import"./vendor-Csw2ODfV.js";import"./i18nInstance-DBIXdvxg.js";import"./react-redux-Y6E60BP4.js";import"./vscode-url-helper-5Tt6LlE2.js";import"./ws-client-provider-BSrrH9C6.js";import"./query-client-config-BvMAX57P.js";import"./redux-toolkit.modern-C17kwIqd.js";import"./agent-state-u5yf9HVO.js";import"./browser-slice-DCstnZW4.js";import"./initial-query-slice-kALvhVye.js";import"./retrieve-axios-error-message-CoJTAmT2.js";import"./mutation-C1zRO6D6.js";import"./use-active-conversation-BPaQhs1t.js";import"./use-conversation-id-DQbtss6X.js";import"./use-optimistic-user-message-YnIWj66e.js";import"./iconBase-6hcKKUBE.js";import"./optional-tag-B9pz552A.js";import"./index-t-SiDJv5.js";const He=(t,s)=>{const a=`${s.hostname==="localhost"?s.protocol:"https:"}//${s.host}/oauth/keycloak/callback`;let o=s.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev");o===s.hostname&&s.hostname!=="localhost"&&(o=`auth.${s.hostname}`);const r="openid email profile",c=s.search?"&":"?",i=`${s.href.replace(/\/$/,"")}${c}login_method=${t}`;return`https://${o}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${t}&response_type=code&redirect_uri=${encodeURIComponent(a)}&scope=${encodeURIComponent(r)}&state=${encodeURIComponent(i)}`},y=t=>t.appMode==="saas"?He(t.identityProvider,new URL(window.location.href)):null,Ve=t=>y({appMode:t.appMode,identityProvider:"github"}),Ye=()=>{const{providers:t}=Ae(),{data:s}=w(),n=te({queryKey:["user"],queryFn:D.getGitUser,enabled:!!(s!=null&&s.APP_MODE)&&t.length>0,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return f.useEffect(()=>{n.data&&se.identify(n.data.login,{company:n.data.company,name:n.data.name,email:n.data.email,user:n.data.login,mode:(s==null?void 0:s.APP_MODE)||"oss"})},[n.data]),n},Ke=t=>u.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("g",{clipPath:"url(#clip0_40000158_426)"},u.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{d:"M4.84641 20.22C4.84641 20.22 7.35344 17.019 13.5395 17.019C19.7255 17.019 22.2337 20.22 22.2337 20.22M13.5395 13.0824C14.4344 13.0824 15.2926 12.7269 15.9254 12.0941C16.5582 11.4613 16.9137 10.6031 16.9137 9.70819C16.9137 8.8133 16.5582 7.95505 15.9254 7.32227C15.2926 6.68948 14.4344 6.33398 13.5395 6.33398C12.6446 6.33398 11.7863 6.68948 11.1536 7.32227C10.5208 7.95505 10.1653 8.8133 10.1653 9.70819C10.1653 10.6031 10.5208 11.4613 11.1536 12.0941C11.7863 12.7269 12.6446 13.0824 13.5395 13.0824Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_40000158_426"},u.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function We({src:t}){const{t:s}=p();return e.jsx("img",{src:t,alt:s(l.AVATAR$ALT_TEXT),className:"w-full h-full rounded-full"})}function v({children:t,tooltip:s,onClick:n,href:a,navLinkTo:o,ariaLabel:r,testId:c,className:d,disabled:i=!1}){const m=C=>{n&&!i&&(n(),C.preventDefault())},E=e.jsx("button",{type:"button","aria-label":r,"data-testid":c,onClick:m,className:I("hover:opacity-80",i&&"opacity-50 cursor-not-allowed",d),disabled:i,children:t});let h;return o&&!i?h=e.jsx(ee,{to:o,onClick:m,className:({isActive:C})=>I("hover:opacity-80",C?"text-white":"text-[#9099AC]",d),"aria-label":r,"data-testid":c,children:t}):o&&i?h=e.jsx("button",{type:"button","aria-label":r,"data-testid":c,className:I("text-[#9099AC]","opacity-50 cursor-not-allowed",d),disabled:!0,children:t}):a&&!i?h=e.jsx("a",{href:a,target:"_blank",rel:"noreferrer noopener",className:I("hover:opacity-80",d),"aria-label":r,"data-testid":c,children:t}):a&&i?h=e.jsx("button",{type:"button","aria-label":r,"data-testid":c,className:I("opacity-50 cursor-not-allowed",d),disabled:!0,children:t}):h=E,e.jsx(Ce,{content:s,closeDelay:100,placement:"right",children:h})}function ze({onClick:t,avatarUrl:s,isLoading:n}){const{t:a}=p();return e.jsxs(v,{testId:"user-avatar",tooltip:a(l.USER$ACCOUNT_SETTINGS),ariaLabel:a(l.USER$ACCOUNT_SETTINGS),onClick:t,className:I("w-8 h-8 rounded-full flex items-center justify-center",n&&"bg-transparent"),children:[!n&&s&&e.jsx(We,{src:s}),!n&&!s&&e.jsx(Ke,{"aria-label":a(l.USER$AVATAR_PLACEHOLDER),width:28,height:28,className:"text-[#9099AC]"}),n&&e.jsx(k,{size:"small"})]})}function Ze({onLogout:t,onClose:s}){const n=ne(s),{t:a}=p();return e.jsx(_e,{testId:"account-settings-context-menu",ref:n,className:"absolute right-full md:left-full -top-1 z-10 w-fit",children:e.jsx(Ie,{onClick:t,children:a(l.ACCOUNT_SETTINGS$LOGOUT)})})}function Qe({onLogout:t,user:s,isLoading:n}){const[a,o]=f.useState(!1),r=()=>{o(i=>!i)},c=()=>{o(!1)},d=()=>{t(),c()};return e.jsxs("div",{"data-testid":"user-actions",className:"w-8 h-8 relative",children:[e.jsx(ze,{avatarUrl:s==null?void 0:s.avatar_url,onClick:r,isLoading:n}),a&&e.jsx(Ze,{onLogout:d,onClose:c})]})}function Xe(){const{t}=p();return e.jsx(v,{tooltip:t(l.BRANDING$ALL_HANDS_AI),ariaLabel:t(l.BRANDING$ALL_HANDS_LOGO),navLinkTo:"/",children:e.jsx(P,{width:34,height:34})})}const Je=t=>u.createElement("svg",{width:27,height:27,viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M24.5719 9.17199V14.8456M15.7404 3.4984C14.9543 3.12524 14.095 2.93164 13.2248 2.93164C12.3546 2.93164 11.4952 3.12524 10.7091 3.4984L3.11671 7.05801C1.46456 7.83189 1.46456 10.5121 3.11671 11.286L10.708 14.8456C11.4943 15.2189 12.3538 15.4126 13.2242 15.4126C14.0946 15.4126 14.9541 15.2189 15.7404 14.8456L23.3328 11.286C24.985 10.5121 24.985 7.83189 23.3328 7.05801L15.7404 3.4984Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{d:"M5.28183 12.5762V18.3916C5.28183 21.7027 10.6082 23.356 13.2249 23.356C15.8415 23.356 21.1679 21.7027 21.1679 18.3916V12.5762",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}));function qe({disabled:t=!1}){const{t:s}=p();return e.jsx(v,{tooltip:s(l.SIDEBAR$DOCS),ariaLabel:s(l.SIDEBAR$DOCS),href:"https://docs.all-hands.dev",disabled:t,children:e.jsx(Je,{width:28,height:28,className:`text-[#9099AC] ${t?"opacity-50":""}`})})}const et=t=>u.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("g",{clipPath:"url(#clip0_40000158_408)"},u.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),u.createElement("path",{d:"M20.5007 12H14.5007V6C14.5007 5.73478 14.3953 5.48043 14.2078 5.29289C14.0203 5.10536 13.7659 5 13.5007 5C13.2355 5 12.9811 5.10536 12.7936 5.29289C12.6061 5.48043 12.5007 5.73478 12.5007 6V12H6.5007C6.23549 12 5.98113 12.1054 5.7936 12.2929C5.60606 12.4804 5.5007 12.7348 5.5007 13C5.5007 13.2652 5.60606 13.5196 5.7936 13.7071C5.98113 13.8946 6.23549 14 6.5007 14H12.5007V20C12.5007 20.2652 12.6061 20.5196 12.7936 20.7071C12.9811 20.8946 13.2355 21 13.5007 21C13.7659 21 14.0203 20.8946 14.2078 20.7071C14.3953 20.5196 14.5007 20.2652 14.5007 20V14H20.5007C20.7659 14 21.0203 13.8946 21.2078 13.7071C21.3953 13.5196 21.5007 13.2652 21.5007 13C21.5007 12.7348 21.3953 12.4804 21.2078 12.2929C21.0203 12.1054 20.7659 12 20.5007 12Z",fill:"currentColor"})),u.createElement("defs",null,u.createElement("clipPath",{id:"clip0_40000158_408"},u.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function tt({disabled:t=!1}){const{t:s}=p(),n=s(l.CONVERSATION$START_NEW);return e.jsx(v,{tooltip:n,ariaLabel:n,navLinkTo:"/",testId:"new-project-button",disabled:t,children:e.jsx(et,{width:28,height:28})})}function st({onClick:t,disabled:s=!1}){const{t:n}=p();return e.jsx(v,{testId:"settings-button",tooltip:n(l.SETTINGS$TITLE),ariaLabel:n(l.SETTINGS$TITLE),onClick:t,navLinkTo:"/settings",disabled:s,children:e.jsx(ve,{width:28,height:28})})}function nt({isOpen:t,onClick:s,disabled:n=!1}){const{t:a}=p();return e.jsx(v,{testId:"toggle-conversation-panel",tooltip:a(l.SIDEBAR$CONVERSATIONS),ariaLabel:a(l.SIDEBAR$CONVERSATIONS),onClick:s,disabled:n,children:e.jsx(je,{size:22,className:I(t?"text-white":"text-[#9099AC]",n&&"opacity-50")})})}function at({testId:t,title:s,description:n,buttons:a}){return e.jsx(Le,{testId:t,title:s,description:n,buttons:[{text:a.danger.text,onClick:a.danger.onClick,className:"bg-danger"},{text:a.cancel.text,onClick:a.cancel.onClick,className:"bg-neutral-500"}]})}const ot=t=>{var d,i,m,E,h;const s=(d=t.get("llm-provider-input"))==null?void 0:d.toString(),n=(i=t.get("llm-model-input"))==null?void 0:i.toString(),a=`${s}/${n}`.toLowerCase(),o=(m=t.get("llm-api-key-input"))==null?void 0:m.toString(),r=(E=t.get("agent"))==null?void 0:E.toString(),c=(h=t.get("language"))==null?void 0:h.toString();return{LLM_MODEL:a,LLM_API_KEY:o,AGENT:r,LANGUAGE:c}},rt=t=>{var i,m,E;const s=Array.from(t.keys()),n=s.includes("use-advanced-options");let a,o,r=!1,c,d=!0;return n&&(a=(i=t.get("custom-model"))==null?void 0:i.toString(),o=(m=t.get("base-url"))==null?void 0:m.toString(),r=s.includes("confirmation-mode"),r&&(c=(E=t.get("security-analyzer"))==null?void 0:E.toString()),d=s.includes("enable-default-condenser")),{CUSTOM_LLM_MODEL:a,LLM_BASE_URL:o,CONFIRMATION_MODE:r,SECURITY_ANALYZER:c,ENABLE_DEFAULT_CONDENSER:d}},lt=t=>{const{LLM_MODEL:s,LLM_API_KEY:n,AGENT:a,LANGUAGE:o}=ot(t),{CUSTOM_LLM_MODEL:r,LLM_BASE_URL:c,CONFIRMATION_MODE:d,SECURITY_ANALYZER:i,ENABLE_DEFAULT_CONDENSER:m}=rt(t);return{LLM_MODEL:r||s,LLM_API_KEY_SET:!!n,AGENT:a,LANGUAGE:o,LLM_BASE_URL:c,CONFIRMATION_MODE:d,SECURITY_ANALYZER:i,ENABLE_DEFAULT_CONDENSER:m,llm_api_key:n}};function it({settings:t,models:s,onClose:n}){const{mutate:a}=B(),o=M(),{t:r}=p(),c=f.useRef(null),[d,i]=f.useState(!1),m=async N=>{const g=lt(N);await a(g,{onSuccess:()=>{n(),se.capture("settings_saved",{LLM_MODEL:g.LLM_MODEL,LLM_API_KEY_SET:g.LLM_API_KEY_SET?"SET":"UNSET",SEARCH_API_KEY_SET:g.SEARCH_API_KEY?"SET":"UNSET",REMOTE_RUNTIME_RESOURCE_FACTOR:g.REMOTE_RUNTIME_RESOURCE_FACTOR})}})},E=()=>{const N=new FormData(c.current??void 0);m(N)},h=N=>{N.preventDefault();const g=new FormData(N.currentTarget);o.pathname.startsWith("/conversations/")?i(!0):m(g)},C=t.LLM_API_KEY_SET;return e.jsxs("div",{children:[e.jsxs("form",{ref:c,"data-testid":"settings-form",className:"flex flex-col gap-6",onSubmit:h,children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Oe,{models:Me(s),currentModel:t.LLM_MODEL}),e.jsx(be,{testId:"llm-api-key-input",name:"llm-api-key-input",label:r(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full",placeholder:C?"<hidden>":"",startContent:C&&e.jsx(Re,{isSet:C})}),e.jsx(we,{testId:"llm-api-key-help-anchor",text:r(l.SETTINGS$DONT_KNOW_API_KEY),linkText:r(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(L,{testId:"save-settings-button",type:"submit",variant:"primary",className:"w-full",children:r(l.BUTTON$SAVE)})})]}),d&&e.jsx(A,{children:e.jsx(at,{title:r(l.MODAL$END_SESSION_TITLE),description:r(l.MODAL$END_SESSION_MESSAGE),buttons:{danger:{text:r(l.BUTTON$END_SESSION),onClick:E},cancel:{text:r(l.BUTTON$CANCEL),onClick:()=>i(!1)}}})})]})}function ct({onClose:t,settings:s}){var o;const n=ye(),{t:a}=p();return e.jsx(A,{children:e.jsxs("div",{"data-testid":"ai-config-modal",className:"bg-base-secondary min-w-[384px] m-4 p-6 rounded-xl flex flex-col gap-2 border border-tertiary",children:[n.error&&e.jsx("p",{className:"text-danger text-xs",children:n.error.message}),e.jsx("span",{className:"text-xl leading-6 font-semibold -tracking-[0.01em]",children:a(l.AI_SETTINGS$TITLE)}),e.jsxs("p",{className:"text-xs text-[#A3A3A3]",children:[a(l.SETTINGS$DESCRIPTION)," ",a(l.SETTINGS$FOR_OTHER_OPTIONS),e.jsx(ue,{"data-testid":"advanced-settings-link",to:"/settings",className:"underline underline-offset-2 text-white",children:a(l.SETTINGS$SEE_ADVANCED_SETTINGS)})]}),n.isLoading&&e.jsx("div",{className:"flex justify-center",children:e.jsx(k,{size:"small"})}),n.data&&e.jsx(it,{settings:s||ge,models:(o=n.data)==null?void 0:o.models,onClose:t})]})})}const dt=()=>{const{data:t}=b();return te({queryKey:["user","conversations"],queryFn:D.getUserConversations,enabled:!!t})},ut=()=>{const t=De();return oe({mutationFn:s=>D.deleteUserConversation(s.conversationId),onMutate:async s=>{await t.cancelQueries({queryKey:["user","conversations"]});const n=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],a=>a==null?void 0:a.filter(o=>o.conversation_id!==s.conversationId)),{previousConversations:n}},onError:(s,n,a)=>{a!=null&&a.previousConversations&&t.setQueryData(["user","conversations"],a.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})};function mt({onConfirm:t,onCancel:s}){const{t:n}=p();return e.jsx(A,{children:e.jsxs(T,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(G,{title:n(l.CONVERSATION$CONFIRM_DELETE)}),e.jsx(ae,{description:n(l.CONVERSATION$DELETE_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:a=>a.stopPropagation(),children:[e.jsx(L,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:n(l.ACTION$CONFIRM)}),e.jsx(L,{type:"button",variant:"secondary",onClick:s,className:"w-full","data-testid":"cancel-button",children:n(l.BUTTON$CANCEL)})]})]})})}function ht({onConfirm:t,onClose:s}){const{t:n}=p();return e.jsx(A,{children:e.jsxs(T,{testID:"confirm-new-conversation-modal",children:[e.jsx(G,{title:n(l.CONVERSATION$EXIT_WARNING)}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(J,{text:n(l.ACTION$CONFIRM),onClick:t,className:"bg-[#C63143] flex-1"}),e.jsx(J,{text:n(l.BUTTON$CANCEL),onClick:s,className:"bg-tertiary flex-1"})]})]})})}function ft({onClose:t}){const{t:s}=p(),{conversationId:n}=me(),a=ne(t),o=R(),[r,c]=f.useState(!1),[d,i]=f.useState(!1),[m,E]=f.useState(null),{data:h,isFetching:C,error:N}=dt(),{mutate:g}=ut(),j=x=>{c(!0),E(x)},S=()=>{m&&g({conversationId:m},{onSuccess:()=>{m===n&&o("/")}})};return e.jsxs("div",{ref:a,"data-testid":"conversation-panel",className:"w-[350px] h-full border border-neutral-700 bg-base-secondary rounded-xl overflow-y-auto absolute",children:[C&&e.jsx("div",{className:"w-full h-full absolute flex justify-center items-center",children:e.jsx(k,{size:"small"})}),N&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-danger",children:N.message})}),(h==null?void 0:h.length)===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-400",children:s(l.CONVERSATION$NO_CONVERSATIONS)})}),h==null?void 0:h.map(x=>e.jsx(ee,{to:`/conversations/${x.conversation_id}`,onClick:t,children:({isActive:O})=>e.jsx(Te,{isActive:O,onDelete:()=>j(x.conversation_id),title:x.title,selectedRepository:x.selected_repository,lastUpdatedAt:x.last_updated_at,createdAt:x.created_at,conversationStatus:x.status,conversationId:x.conversation_id})},x.conversation_id)),r&&e.jsx(mt,{onConfirm:()=>{S(),c(!1)},onCancel:()=>c(!1)}),d&&e.jsx(ht,{onConfirm:()=>{t()},onClose:()=>i(!1)})]})}function pt({isOpen:t,children:s}){if(!t)return null;const n=document.getElementById("root-outlet");return n?Ne.createPortal(e.jsx("div",{className:"absolute h-full w-full left-0 top-0 z-20 bg-black/80 rounded-xl",children:s}),n):null}function Et(){const t=M(),s=Ye(),{data:n}=w(),{data:a,error:o,isError:r,isFetching:c}=$(),{mutate:d}=Pe(),[i,m]=f.useState(!1),[E,h]=f.useState(!1),C=(n==null?void 0:n.FEATURE_FLAGS.HIDE_LLM_SETTINGS)&&(n==null?void 0:n.APP_MODE)==="saas";return f.useEffect(()=>{C||(t.pathname==="/settings"?m(!1):!c&&r&&(o==null?void 0:o.status)!==404?re("Something went wrong while fetching settings. Please reload the page."):(n==null?void 0:n.APP_MODE)==="oss"&&(o==null?void 0:o.status)===404&&m(!0))},[o==null?void 0:o.status,o,c,t.pathname]),e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"h-[40px] md:h-auto px-1 flex flex-row md:flex-col gap-1",children:[e.jsxs("nav",{className:"flex flex-row md:flex-col items-center justify-between w-full h-auto md:w-auto md:h-full",children:[e.jsxs("div",{className:"flex flex-row md:flex-col items-center gap-[26px]",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Xe,{})}),e.jsx(tt,{disabled:(a==null?void 0:a.EMAIL_VERIFIED)===!1}),e.jsx(nt,{isOpen:E,onClick:()=>(a==null?void 0:a.EMAIL_VERIFIED)===!1?null:h(N=>!N),disabled:(a==null?void 0:a.EMAIL_VERIFIED)===!1})]}),e.jsxs("div",{className:"flex flex-row md:flex-col md:items-center gap-[26px] md:mb-4",children:[e.jsx(qe,{disabled:(a==null?void 0:a.EMAIL_VERIFIED)===!1}),e.jsx(st,{disabled:(a==null?void 0:a.EMAIL_VERIFIED)===!1}),e.jsx(Qe,{user:s.data?{avatar_url:s.data.avatar_url}:void 0,onLogout:d,isLoading:s.isFetching})]})]}),E&&e.jsx(pt,{isOpen:E,children:e.jsx(ft,{onClose:()=>h(!1)})})]}),i&&e.jsx(ct,{settings:a,onClose:()=>m(!1)})]})}const xt=t=>u.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},u.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),Ct=t=>u.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...t},u.createElement("defs",null,u.createElement("style",null,".cls-1{fill:currentColor;}")),u.createElement("g",{id:"LOGO"},u.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"})));function Nt({githubAuthUrl:t,appMode:s}){const{t:n}=p(),a=y({appMode:s||null,identityProvider:"gitlab"}),o=()=>{t&&(window.location.href=t)},r=()=>{a&&(window.location.href=a)};return e.jsx(A,{children:e.jsxs(T,{className:"border border-tertiary",children:[e.jsx(P,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:n(l.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),e.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[e.jsx(L,{type:"button",variant:"primary",onClick:o,className:"w-full",startContent:e.jsx(xt,{width:20,height:20}),children:n(l.GITHUB$CONNECT_TO_GITHUB)}),e.jsx(L,{type:"button",variant:"primary",onClick:r,className:"w-full",startContent:e.jsx(Ct,{width:20,height:20}),children:n(l.GITLAB$CONNECT_TO_GITLAB)})]})]})})}function gt(){const{t}=p();return e.jsx(A,{children:e.jsxs(T,{className:"border border-tertiary",children:[e.jsx(P,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:t(l.AUTH$LOGGING_BACK_IN)})})]})})}function St({onClose:t}){const{t:s}=p(),{mutate:n}=B(),a=async o=>{o.preventDefault();const c=new FormData(o.currentTarget).get("analytics")==="on";n({user_consents_to_analytics:c},{onSuccess:()=>{le(c),t()}})};return e.jsx(A,{children:e.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:a,className:"flex flex-col gap-2",children:e.jsxs(T,{className:"border border-tertiary",children:[e.jsx(G,{title:s(l.ANALYTICS$TITLE)}),e.jsx(ae,{children:s(l.ANALYTICS$DESCRIPTION)}),e.jsxs("label",{className:"flex gap-2 items-center self-start",children:[e.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),s(l.ANALYTICS$SEND_ANONYMOUS_DATA)]}),e.jsx(L,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:s(l.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const At=()=>{const{mutate:t}=B();return{migrateUserConsent:f.useCallback(async n=>{const a=localStorage.getItem("analytics-consent");a&&(n==null||n.handleAnalyticsWasPresentInLocalStorage(),await t({user_consents_to_analytics:a==="true"},{onSuccess:()=>{le(a==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function _t(){const{t}=p(),{mutate:s,isPending:n}=oe({mutationFn:D.createBillingSessionResponse,onSuccess:a=>{window.location.href=a},onError:()=>{re(t(l.BILLING$ERROR_WHILE_CREATING_SESSION))}});return e.jsx(A,{children:e.jsxs(T,{className:"border border-tertiary",children:[e.jsx(P,{width:68,height:46}),e.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t(l.BILLING$YOUVE_GOT_50)}),e.jsx("p",{children:e.jsx(Be,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:e.jsx("strong",{})}})})]}),e.jsx(L,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:n,onClick:s,children:t(l.BILLING$PROCEED_TO_STRIPE)})]})})}const It=()=>{const{data:t,isLoading:s}=w(),{data:n,isLoading:a}=b(),o=Ue(),r=y({appMode:(t==null?void 0:t.APP_MODE)||null,identityProvider:"github"}),c=y({appMode:(t==null?void 0:t.APP_MODE)||null,identityProvider:"gitlab"});u.useEffect(()=>{if((t==null?void 0:t.APP_MODE)!=="saas"||s||a||n||!o)return;const d=o===U.GITHUB?r:c;if(d){const i=new URL(d);i.searchParams.append("login_method",o),window.location.href=i.toString()}},[t==null?void 0:t.APP_MODE,n,s,a,o,r,c])},Lt=()=>{const t=M(),{data:s,isLoading:n}=b(),{data:a}=w(),o=R();u.useEffect(()=>{if((a==null?void 0:a.APP_MODE)!=="saas"||n||!s)return;const r=new URLSearchParams(t.search),c=r.get("login_method");if(c===U.GITHUB||c===U.GITLAB){$e(c),r.delete("login_method");const d=`${t.pathname}${r.toString()?`?${r.toString()}`:""}`;o(d,{replace:!0})}},[s,n,t.search,a==null?void 0:a.APP_MODE])};function Tt({children:t}){const{data:s,isLoading:n}=$(),a=R(),{pathname:o}=M();return f.useEffect(()=>{n||(s==null?void 0:s.EMAIL_VERIFIED)===!1&&o!=="/settings/user"&&a("/settings/user",{replace:!0})},[s==null?void 0:s.EMAIL_VERIFIED,o,a,n]),t}const Ss=he(function(){const s=Ee(),{t:n}=p();return xe(s)?e.jsxs("div",{children:[e.jsx("h1",{children:s.status}),e.jsx("p",{children:s.statusText}),e.jsx("pre",{children:s.data instanceof Object?JSON.stringify(s.data):s.data})]}):s instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:n(l.ERROR$GENERIC)}),e.jsx("pre",{children:s.message})]}):e.jsx("div",{children:e.jsx("h1",{children:n(l.ERROR$UNKNOWN)})})}),As=fe(function(){var F,H,V,Y,K,W,z,Z,Q;const s=R(),{pathname:n}=M(),a=Se(),{data:o}=$(),{error:r}=Ge(),{migrateUserConsent:c}=At(),{t:d}=p(),i=w(),{data:m,isFetching:E,isError:h}=b(),C=Ve({appMode:((F=i.data)==null?void 0:F.APP_MODE)||null,gitHubClientId:((H=i.data)==null?void 0:H.GITHUB_CLIENT_ID)||null}),N=a?null:C,[g,j]=f.useState(!1);It(),Lt(),f.useEffect(()=>{!a&&(o!=null&&o.LANGUAGE)&&Fe.changeLanguage(o.LANGUAGE)},[o==null?void 0:o.LANGUAGE,a]),f.useEffect(()=>{if(!a){const _=(o==null?void 0:o.USER_CONSENTS_TO_ANALYTICS)===null;j(_)}},[o,a]),f.useEffect(()=>{a||c({handleAnalyticsWasPresentInLocalStorage:()=>{j(!1)}})},[a]),f.useEffect(()=>{var _;o!=null&&o.IS_NEW_USER&&((_=i.data)==null?void 0:_.APP_MODE)==="saas"&&ke(d(l.BILLING$YOURE_IN))},[o==null?void 0:o.IS_NEW_USER,(V=i.data)==null?void 0:V.APP_MODE]),f.useEffect(()=>{!a&&(r==null?void 0:r.status)===402&&n!=="/"&&s("/")},[r==null?void 0:r.status,n,a]);const S=f.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(q.LOGIN_METHOD)!==null:!1,[]),[x,O]=f.useState(S());f.useEffect(()=>{const _=de=>{de.key===q.LOGIN_METHOD&&O(S())},X=()=>{O(S())};return window.addEventListener("storage",_),window.addEventListener("focus",X),()=>{window.removeEventListener("storage",_),window.removeEventListener("focus",X)}},[S]),f.useEffect(()=>{O(S())},[m,S]);const ie=!m&&!h&&!E&&!a&&((Y=i.data)==null?void 0:Y.APP_MODE)==="saas"&&!x,ce=!m&&!h&&!E&&!a&&((K=i.data)==null?void 0:K.APP_MODE)==="saas"&&x;return e.jsxs("div",{"data-testid":"root-layout",className:"bg-base p-3 h-screen md:min-w-[1024px] flex flex-col md:flex-row gap-3",children:[e.jsx(Et,{}),e.jsx("div",{id:"root-outlet",className:"h-[calc(100%-50px)] md:h-full w-full relative overflow-auto",children:e.jsx(Tt,{children:e.jsx(pe,{})})}),ie&&e.jsx(Nt,{githubAuthUrl:N,appMode:(W=i.data)==null?void 0:W.APP_MODE}),ce&&e.jsx(gt,{}),((z=i.data)==null?void 0:z.APP_MODE)==="oss"&&g&&e.jsx(St,{onClose:()=>{j(!1)}}),((Z=i.data)==null?void 0:Z.FEATURE_FLAGS.ENABLE_BILLING)&&((Q=i.data)==null?void 0:Q.APP_MODE)==="saas"&&(o==null?void 0:o.IS_NEW_USER)&&e.jsx(_t,{})]})});export{Ss as ErrorBoundary,As as default};
