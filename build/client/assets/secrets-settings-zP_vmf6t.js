import{R as g,w as $,e as Q}from"./router-CPryua6o.js";import{j as e}from"./ui-Cq19CwDI.js";import{u as q}from"./open-hands-axios-bwh8x0Ai.js";import{u as L}from"./useQuery-C1weQHjG.js";import{S as E}from"./secrets-service-R2uAE4Km.js";import{u as A}from"./use-user-providers-Ddi7hhkA.js";import{u as M}from"./use-config-BEd2J5_T.js";import{u as T,B as p}from"./brand-button-CwmiDb9A.js";import{S as V}from"./settings-input-CLGKJpTa.js";import{c as O}from"./utils-SnfsJp9N.js";import{O as K}from"./optional-tag-B9pz552A.js";import{u as P}from"./useTranslation-8HK8Q2x7.js";import{F as B,a as z}from"./index-YOctmEaY.js";import{M as G}from"./modal-backdrop-DQZszq-6.js";import"./vendor-Csw2ODfV.js";import"./open-hands-Dol13NBS.js";import"./use-settings-DphRp9S7.js";import"./module-eUUeIAmF.js";import"./mutation-C1zRO6D6.js";import"./i18nInstance-DBIXdvxg.js";import"./iconBase-6hcKKUBE.js";const U=()=>{const{data:t}=M(),{providers:r}=A(),a=(t==null?void 0:t.APP_MODE)==="oss";return L({queryKey:["secrets"],queryFn:E.getSecrets,enabled:a||r.length>0})},W=()=>T({mutationFn:t=>E.deleteSecret(t)}),Y=()=>T({mutationFn:({name:t,value:r,description:a})=>E.createSecret(t,r,a)}),H=()=>T({mutationFn:({secretToEdit:t,name:r,description:a})=>E.updateSecret(t,r,a)});function J({mode:t,selectedSecret:r,onCancel:a}){var j,y;const o=q(),{t:u}=P(),{data:c}=U(),{mutate:w}=Y(),{mutate:C}=H(),[S,l]=g.useState(null),x=t==="edit"&&r&&((y=(j=c==null?void 0:c.find(n=>n.name===r))==null?void 0:j.description)==null?void 0:y.trim())||"",f=(n,i,s)=>{w({name:n,value:i,description:s},{onSettled:a,onSuccess:async()=>{await o.invalidateQueries({queryKey:["secrets"]})}})},h=(n,i,s)=>{o.setQueryData(["secrets"],d=>d?d.map(m=>m.name===n?{...m,name:i,description:s}:m):[])},N=()=>{o.invalidateQueries({queryKey:["secrets"]})},b=(n,i,s)=>{h(n,i,s),C({secretToEdit:n,name:i,description:s},{onSettled:a,onError:N})},v=n=>{var I,F,_;n.preventDefault();const i=new FormData(n.currentTarget),s=(I=i.get("secret-name"))==null?void 0:I.toString(),d=(F=i.get("secret-value"))==null?void 0:F.toString().trim(),m=(_=i.get("secret-description"))==null?void 0:_.toString();if(s){if(l(null),c==null?void 0:c.some(k=>k.name===s&&k.name!==r)){l("Secret already exists");return}if(t==="add"){if(!d){l(u("SECRETS$SECRET_VALUE_REQUIRED"));return}f(s,d,m||void 0)}else t==="edit"&&r&&b(r,s,m||void 0)}},D=t==="add"?"add-secret-form":"edit-secret-form";return e.jsxs("form",{"data-testid":D,onSubmit:v,className:"flex flex-col items-start gap-6",children:[e.jsx(V,{testId:"name-input",name:"secret-name",type:"text",label:"Name",className:"w-full max-w-[350px]",required:!0,defaultValue:t==="edit"&&r?r:"",placeholder:"e.g. OpenAI_API_Key",pattern:"^\\S*$"}),S&&e.jsx("p",{className:"text-red-500 text-sm",children:S}),t==="add"&&e.jsxs("label",{className:"flex flex-col gap-2.5 w-full max-w-[680px]",children:[e.jsx("span",{className:"text-sm",children:"Value"}),e.jsx("textarea",{"data-testid":"value-input",name:"secret-value",required:!0,className:O("resize-none","bg-tertiary border border-[#717888] rounded-sm p-2 placeholder:italic placeholder:text-tertiary-alt","disabled:bg-[#2D2F36] disabled:border-[#2D2F36] disabled:cursor-not-allowed"),rows:8})]}),e.jsxs("label",{className:"flex flex-col gap-2.5 w-full max-w-[680px]",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm",children:"Description"}),e.jsx(K,{})]}),e.jsx("input",{"data-testid":"description-input",name:"secret-description",defaultValue:x,className:O("resize-none","bg-tertiary border border-[#717888] rounded-sm p-2 placeholder:italic placeholder:text-tertiary-alt","disabled:bg-[#2D2F36] disabled:border-[#2D2F36] disabled:cursor-not-allowed")})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(p,{testId:"cancel-button",type:"button",variant:"secondary",onClick:a,children:"Cancel"}),e.jsxs(p,{testId:"submit-button",type:"submit",variant:"primary",children:[t==="add"&&u("SECRETS$ADD_SECRET"),t==="edit"&&u("SECRETS$EDIT_SECRET")]})]})]})}function R(){return e.jsxs("div",{className:"border-t border-[#717888] last-of-type:border-b max-w-[830px] pr-2.5 py-[13px] flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center justify-between w-1/3",children:[e.jsx("span",{className:"skeleton h-4 w-1/2"}),e.jsx("span",{className:"skeleton h-4 w-1/4"})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("span",{className:"skeleton h-4 w-4"}),e.jsx("span",{className:"skeleton h-4 w-4"})]})]})}function X({title:t,description:r,onEdit:a,onDelete:o}){return e.jsxs("tr",{"data-testid":"secret-item",className:"border-t border-[#717888] last-of-type:border-b max-w-[830px] py-[13px] flex w-full items-center",children:[e.jsx("td",{className:"w-1/4 text-sm text-content-2",children:t}),e.jsx("td",{className:"w-1/2 truncate overflow-hidden whitespace-nowrap text-sm text-content-2 opacity-80 italic",children:r||"-"}),e.jsxs("td",{className:"w-1/4 flex items-center justify-end gap-4",children:[e.jsx("button",{"data-testid":"edit-secret-button",type:"button",onClick:a,"aria-label":`Edit ${t}`,children:e.jsx(B,{size:16})}),e.jsx("button",{"data-testid":"delete-secret-button",type:"button",onClick:o,"aria-label":`Delete ${t}`,children:e.jsx(z,{size:16})})]})]})}function Z({text:t,onConfirm:r,onCancel:a}){return e.jsx(G,{onClose:a,children:e.jsxs("div",{"data-testid":"confirmation-modal",className:"bg-base-secondary p-4 rounded-xl flex flex-col gap-4 border border-tertiary",children:[e.jsx("p",{children:t}),e.jsxs("div",{className:"w-full flex gap-2",children:[e.jsx(p,{testId:"cancel-button",type:"button",onClick:a,variant:"secondary",className:"grow",children:"Cancel"}),e.jsx(p,{testId:"confirm-button",type:"button",onClick:r,variant:"primary",className:"grow",children:"Confirm"})]})]})})}function ee(){const t=q(),{t:r}=P(),{data:a}=M(),{data:o,isLoading:u}=U(),{mutate:c}=W(),{providers:w}=A(),C=(a==null?void 0:a.APP_MODE)==="saas",S=w.length>0,[l,x]=g.useState("list"),[f,h]=g.useState(null),[N,b]=g.useState(!1),v=s=>{t.setQueryData(["secrets"],d=>d?d.filter(m=>m.name!==s):[])},D=()=>{t.invalidateQueries({queryKey:["secrets"]})},j=s=>{v(s),c(s,{onSettled:()=>{b(!1)},onError:D})},y=()=>{f&&j(f)},n=()=>{b(!1)},i=C&&!S;return e.jsxs("div",{"data-testid":"secrets-settings-screen",className:"px-11 py-9 flex flex-col gap-5",children:[u&&l==="list"&&e.jsxs("ul",{children:[e.jsx(R,{}),e.jsx(R,{}),e.jsx(R,{})]}),i&&e.jsx(Q,{to:"/settings/git","data-testid":"connect-git-button",type:"button",children:e.jsx(p,{type:"button",variant:"secondary",children:"Connect a Git provider to manage secrets"})}),(o==null?void 0:o.length)===0&&l==="list"&&e.jsx("p",{"data-testid":"no-secrets-message",children:r("SECRETS$NO_SECRETS_FOUND")}),l==="list"&&e.jsx("table",{className:"w-full",children:e.jsx("tbody",{children:o==null?void 0:o.map(s=>e.jsx(X,{title:s.name,description:s.description,onEdit:()=>{x("edit-secret-form"),h(s.name)},onDelete:()=>{b(!0),h(s.name)}},s.name))})}),!i&&l==="list"&&e.jsx(p,{testId:"add-secret-button",type:"button",variant:"primary",onClick:()=>x("add-secret-form"),isDisabled:u,children:r("SECRETS$ADD_NEW_SECRET")}),(l==="add-secret-form"||l==="edit-secret-form")&&e.jsx(J,{mode:l==="add-secret-form"?"add":"edit",selectedSecret:f,onCancel:()=>x("list")}),N&&e.jsx(Z,{text:r("SECRETS$CONFIRM_DELETE_KEY"),onConfirm:y,onCancel:n})]})}const we=$(ee);export{we as default};
