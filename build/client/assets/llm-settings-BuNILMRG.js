import{w as oe,R as T}from"./router-CPryua6o.js";import{j as s}from"./ui-Cq19CwDI.js";import{o as H,e as ie,u as re,M as ce,H as _}from"./help-link-yrwnyn8z.js";import{D as p,u as de}from"./use-settings-DphRp9S7.js";import{u as pe}from"./use-save-settings-Ds-eMOrk.js";import{S as M,a as R}from"./switch-skeleton-CAK4PGjj.js";import{I as l}from"./declaration-DtqZiF37.js";import{S as d}from"./settings-input-CLGKJpTa.js";import{B as Ee}from"./brand-button-CwmiDb9A.js";import{a as Se,d as me}from"./custom-toast-handlers-qEjLUNGq.js";import{r as Ie}from"./retrieve-axios-error-message-CoJTAmT2.js";import{S as O}from"./settings-dropdown-input-iBqLcpmc.js";import{u as ue}from"./use-config-BEd2J5_T.js";import{I as N}from"./input-skeleton-BqX4Bc0H.js";import{S as Ae}from"./subtext-skeleton-CtiWmIrt.js";import{K as y}from"./key-status-icon-DfYhW2cB.js";import{u as Te}from"./useTranslation-8HK8Q2x7.js";import"./vendor-Csw2ODfV.js";import"./useQuery-C1weQHjG.js";import"./open-hands-axios-bwh8x0Ai.js";import"./open-hands-Dol13NBS.js";import"./module-eUUeIAmF.js";import"./utils-SnfsJp9N.js";import"./optional-tag-B9pz552A.js";import"./mutation-C1zRO6D6.js";import"./index-t-SiDJv5.js";import"./i18nInstance-DBIXdvxg.js";const _e=a=>Object.keys(a).length>0&&(!!a.LLM_BASE_URL||a.AGENT!==p.AGENT||a.CONFIRMATION_MODE||!!a.SECURITY_ANALYZER),Ne=(a,E)=>{if(!E)return!1;const c=H(a),{provider:i,model:e}=ie(E);return!(i in c&&c[i].models.includes(e))};function ye(){return s.jsxs("div",{"data-testid":"app-settings-skeleton",className:"px-11 py-9 flex flex-col gap-6",children:[s.jsx(M,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(N,{}),s.jsx(Ae,{}),s.jsx(M,{}),s.jsx(M,{}),s.jsx(N,{})]})}function fe(){const{t:a}=Te(),{mutate:E,isPending:c}=pe(),{data:i}=re(),{data:e,isLoading:D,isFetching:b}=de(),{data:f}=ue(),[S,h]=T.useState("basic"),[B,x]=T.useState(!1),[z,r]=T.useState({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1}),V=H((i==null?void 0:i.models)||[]);T.useEffect(()=>{const n=i&&e?Ne(i.models,e.LLM_MODEL)||_e({...e}):!1;e&&x(e.CONFIRMATION_MODE),h(n?"advanced":"basic")},[e,i]);const K=()=>{me(a(l.SETTINGS$SAVED)),r({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1})},j=t=>{const n=Ie(t);Se(n||a(l.ERROR$GENERIC))},Z=t=>{var m,u,A,I;const n=(m=t.get("llm-provider-input"))==null?void 0:m.toString(),o=(u=t.get("llm-model-input"))==null?void 0:u.toString(),L=(A=t.get("llm-api-key-input"))==null?void 0:A.toString(),C=(I=t.get("search-api-key-input"))==null?void 0:I.toString(),g=n&&o&&`${n}/${o}`.toLowerCase();E({LLM_MODEL:g,llm_api_key:L||null,SEARCH_API_KEY:C||"",LLM_BASE_URL:p.LLM_BASE_URL,AGENT:p.AGENT,CONFIRMATION_MODE:p.CONFIRMATION_MODE,SECURITY_ANALYZER:p.SECURITY_ANALYZER,ENABLE_DEFAULT_CONDENSER:p.ENABLE_DEFAULT_CONDENSER},{onSuccess:K,onError:j})},W=t=>{var I,v,G,P,U,k,$,F;const n=(I=t.get("llm-custom-model-input"))==null?void 0:I.toString(),o=(v=t.get("base-url-input"))==null?void 0:v.toString(),L=(G=t.get("llm-api-key-input"))==null?void 0:G.toString(),C=(P=t.get("search-api-key-input"))==null?void 0:P.toString(),g=(U=t.get("agent-input"))==null?void 0:U.toString(),m=((k=t.get("enable-confirmation-mode-switch"))==null?void 0:k.toString())==="on",u=(($=t.get("enable-memory-condenser-switch"))==null?void 0:$.toString())==="on",A=(F=t.get("security-analyzer-input"))==null?void 0:F.toString();E({LLM_MODEL:n,LLM_BASE_URL:o,llm_api_key:L||null,SEARCH_API_KEY:C||"",AGENT:g,CONFIRMATION_MODE:m,ENABLE_DEFAULT_CONDENSER:u,SECURITY_ANALYZER:m?A:void 0},{onSuccess:K,onError:j})},q=t=>{S==="basic"?Z(t):W(t)},J=t=>{x(!!(e!=null&&e.CONFIRMATION_MODE)),h(t?"advanced":"basic"),r({model:!1,apiKey:!1,searchApiKey:!1,baseUrl:!1,agent:!1,confirmationMode:!1,enableDefaultCondenser:!1,securityAnalyzer:!1})},Q=t=>{const n=t!==(e==null?void 0:e.LLM_MODEL.replace("openai/",""));r(o=>({...o,model:n}))},w=t=>{const n=t!=="";r(o=>({...o,apiKey:n}))},Y=t=>{const n=t!==(e==null?void 0:e.SEARCH_API_KEY);r(o=>({...o,searchApiKey:n}))},X=t=>{const n=t!==(e==null?void 0:e.LLM_MODEL)&&t!=="";r(o=>({...o,model:n}))},ee=t=>{const n=t!==(e==null?void 0:e.LLM_BASE_URL);r(o=>({...o,baseUrl:n}))},te=t=>{const n=t!==(e==null?void 0:e.AGENT)&&t!=="";r(o=>({...o,agent:n}))},se=t=>{x(t);const n=t!==(e==null?void 0:e.CONFIRMATION_MODE);r(o=>({...o,confirmationMode:n}))},ae=t=>{const n=t!==(e==null?void 0:e.ENABLE_DEFAULT_CONDENSER);r(o=>({...o,enableDefaultCondenser:n}))},ne=t=>{const n=t!==(e==null?void 0:e.SECURITY_ANALYZER);r(o=>({...o,securityAnalyzer:n}))},le=Object.values(z).some(t=>t);return!e||b?s.jsx(ye,{}):s.jsx("div",{"data-testid":"llm-settings-screen",className:"h-full",children:s.jsxs("form",{action:q,className:"flex flex-col h-full justify-between",children:[s.jsxs("div",{className:"p-9 flex flex-col gap-6",children:[s.jsx(R,{testId:"advanced-settings-switch",defaultIsToggled:S==="advanced",onToggle:J,isToggled:S==="advanced",children:a(l.SETTINGS$ADVANCED)}),S==="basic"&&s.jsxs("div",{"data-testid":"llm-settings-form-basic",className:"flex flex-col gap-6",children:[!D&&!b&&s.jsx(ce,{models:V,currentModel:e.LLM_MODEL||"anthropic/claude-sonnet-4-20250514",onChange:Q}),s.jsx(d,{testId:"llm-api-key-input",name:"llm-api-key-input",label:a(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:e.LLM_API_KEY_SET?"<hidden>":"",onChange:w,startContent:e.LLM_API_KEY_SET&&s.jsx(y,{isSet:e.LLM_API_KEY_SET})}),s.jsx(_,{testId:"llm-api-key-help-anchor",text:a(l.SETTINGS$DONT_KNOW_API_KEY),linkText:a(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"}),s.jsx(d,{testId:"search-api-key-input",name:"search-api-key-input",label:a(l.SETTINGS$SEARCH_API_KEY),type:"password",className:"w-full max-w-[680px]",defaultValue:e.SEARCH_API_KEY||"",onChange:Y,placeholder:"sk-tavily-...",startContent:e.SEARCH_API_KEY_SET&&s.jsx(y,{isSet:e.SEARCH_API_KEY_SET})}),s.jsx(_,{testId:"search-api-key-help-anchor",text:a(l.SETTINGS$SEARCH_API_KEY_OPTIONAL),linkText:a(l.SETTINGS$SEARCH_API_KEY_INSTRUCTIONS),href:"https://tavily.com/"})]}),S==="advanced"&&s.jsxs("div",{"data-testid":"llm-settings-form-advanced",className:"flex flex-col gap-6",children:[s.jsx(d,{testId:"llm-custom-model-input",name:"llm-custom-model-input",label:a(l.SETTINGS$CUSTOM_MODEL),defaultValue:e.LLM_MODEL||"anthropic/claude-sonnet-4-20250514",placeholder:"anthropic/claude-sonnet-4-20250514",type:"text",className:"w-full max-w-[680px]",onChange:X}),s.jsx(d,{testId:"base-url-input",name:"base-url-input",label:a(l.SETTINGS$BASE_URL),defaultValue:e.LLM_BASE_URL,placeholder:"https://api.openai.com",type:"text",className:"w-full max-w-[680px]",onChange:ee}),s.jsx(d,{testId:"llm-api-key-input",name:"llm-api-key-input",label:a(l.SETTINGS_FORM$API_KEY),type:"password",className:"w-full max-w-[680px]",placeholder:e.LLM_API_KEY_SET?"<hidden>":"",onChange:w,startContent:e.LLM_API_KEY_SET&&s.jsx(y,{isSet:e.LLM_API_KEY_SET})}),s.jsx(_,{testId:"llm-api-key-help-anchor-advanced",text:a(l.SETTINGS$DONT_KNOW_API_KEY),linkText:a(l.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"}),s.jsx(d,{testId:"search-api-key-input",name:"search-api-key-input",label:a(l.SETTINGS$SEARCH_API_KEY),type:"password",className:"w-full max-w-[680px]",defaultValue:e.SEARCH_API_KEY||"",onChange:Y,placeholder:"tvly-...",startContent:e.SEARCH_API_KEY_SET&&s.jsx(y,{isSet:e.SEARCH_API_KEY_SET})}),s.jsx(_,{testId:"search-api-key-help-anchor",text:a(l.SETTINGS$SEARCH_API_KEY_OPTIONAL),linkText:a(l.SETTINGS$SEARCH_API_KEY_INSTRUCTIONS),href:"https://tavily.com/"}),s.jsx(O,{testId:"agent-input",name:"agent-input",label:a(l.SETTINGS$AGENT),items:(i==null?void 0:i.agents.map(t=>({key:t,label:t})))||[],defaultSelectedKey:e.AGENT,isClearable:!1,onInputChange:te,wrapperClassName:"w-full max-w-[680px]"}),(f==null?void 0:f.APP_MODE)==="saas"&&s.jsx(O,{testId:"runtime-settings-input",name:"runtime-settings-input",label:s.jsxs(s.Fragment,{children:[a(l.SETTINGS$RUNTIME_SETTINGS),s.jsx("a",{href:"mailto:contact@all-hands.dev",children:a(l.SETTINGS$GET_IN_TOUCH)})]}),items:[],isDisabled:!0,wrapperClassName:"w-full max-w-[680px]"}),s.jsx(R,{testId:"enable-memory-condenser-switch",name:"enable-memory-condenser-switch",defaultIsToggled:e.ENABLE_DEFAULT_CONDENSER,onToggle:ae,children:a(l.SETTINGS$ENABLE_MEMORY_CONDENSATION)}),s.jsx(R,{testId:"enable-confirmation-mode-switch",name:"enable-confirmation-mode-switch",onToggle:se,defaultIsToggled:e.CONFIRMATION_MODE,isBeta:!0,children:a(l.SETTINGS$CONFIRMATION_MODE)}),B&&s.jsx(O,{testId:"security-analyzer-input",name:"security-analyzer-input",label:a(l.SETTINGS$SECURITY_ANALYZER),items:(i==null?void 0:i.securityAnalyzers.map(t=>({key:t,label:t})))||[],placeholder:a(l.SETTINGS$SECURITY_ANALYZER_PLACEHOLDER),defaultSelectedKey:e.SECURITY_ANALYZER,isClearable:!0,showOptionalTag:!0,onInputChange:ne,wrapperClassName:"w-full max-w-[680px]"})]})]}),s.jsx("div",{className:"flex gap-6 p-6 justify-end border-t border-t-tertiary",children:s.jsxs(Ee,{testId:"submit-button",type:"submit",variant:"primary",isDisabled:!le||c,children:[!c&&a("SETTINGS$SAVE_CHANGES"),c&&a("SETTINGS$SAVING")]})})]})})}const qe=oe(fe);export{qe as default};
